import { useEffect, useState, useCallback } from "react";
import { Icons, pdfStyles } from "./newFile";

import {
  Document,
  Page,
  View,
  Text,
} from "@react-pdf/renderer";
import { Image } from "@react-pdf/renderer";
import { stateImages, getStateImages } from "./images";



// Add this helper function at the top of the component
const decodeHtmlEntities = (text) => {
  if (!text) return "";
  return text
    .replace(/&nbsp;/g, " ")
    .replace(/&amp;/g, "&")
    .replace(/&lt;/g, "<")
    .replace(/&gt;/g, ">")
    .replace(/&quot;/g, '"')
    .replace(/&#39;/g, "'")
    .replace(/<[^>]*>/g, "") // Remove HTML tags
    .trim();
};

// Helper function to ensure text ends with a period and format properly
const formatInclusionExclusionText = (text) => {
  if (!text) return "";
  let formatted = text.trim();
  // Remove existing trailing punctuation
  formatted = formatted.replace(/[.,;:!?]+$/, "");
  // Add period if not empty
  if (formatted.length > 0) {
    formatted += ".";
  }
  return formatted;
};

// Enhanced HTML parser for list items with formatting
const parseHtmlContent = (htmlString) => {
  if (!htmlString) return [];
  
  // Extract list items from ol/ul tags
  const listItemRegex = /<li[^>]*>(.*?)<\/li>/gs;
  const matches = [...htmlString.matchAll(listItemRegex)];
  
  if (matches.length === 0) {
    // If no list items found, try paragraph parsing as fallback
    return htmlString
      .replace(/<p>/g, "")
      .split("</p>")
      .map((item) => parseInlineFormatting(item))
      .filter((item) => item && item.length > 0);
  }
  
  return matches.map(match => parseInlineFormatting(match[1]));
};

// Parse inline formatting like <strong>, <span>, etc. and return text segments with formatting info
const parseInlineFormatting = (htmlString) => {
  if (!htmlString) return [];
  
  // Remove style attributes and color attributes
  let cleaned = htmlString.replace(/style="[^"]*"/g, '')
                          .replace(/color:\s*rgb\([^)]*\);?/g, '');
  
  // Extract text segments with their formatting
  const segments = [];
  let currentText = '';
  let isBold = false;
  
  // Simple parser that handles <strong> tags
  const strongRegex = /<strong[^>]*>(.*?)<\/strong>/gs;
  let lastIndex = 0;
  
  for (const match of cleaned.matchAll(strongRegex)) {
    // Add text before the strong tag
    const beforeText = cleaned.substring(lastIndex, match.index);
    if (beforeText) {
      const cleanedBefore = beforeText.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
      if (cleanedBefore) {
        segments.push({ text: cleanedBefore, bold: false });
      }
    }
    
    // Add the bold text
    const boldText = match[1].replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
    if (boldText) {
      segments.push({ text: boldText, bold: true });
    }
    
    lastIndex = match.index + match[0].length;
  }
  
  // Add remaining text after the last match
  if (lastIndex < cleaned.length) {
    const remainingText = cleaned.substring(lastIndex).replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
    if (remainingText) {
      segments.push({ text: remainingText, bold: false });
    }
  }
  
  // If no segments were created, just clean and return the whole text
  if (segments.length === 0) {
    const fullText = cleaned.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
    if (fullText) {
      segments.push({ text: fullText, bold: false });
    }
  }
  
  return segments;
};

const arrayBufferToBase64 = (buffer) => {
  let binary = "";
  const bytes = new Uint8Array(buffer);
  const len = bytes.byteLength;
  for (let i = 0; i < len; i += 1) {
    binary += String.fromCharCode(bytes[i]);
  }

  if (typeof globalThis !== "undefined") {
    if (typeof globalThis.btoa === "function") {
      return globalThis.btoa(binary);
    }
    if (typeof globalThis.Buffer !== "undefined") {
      return globalThis.Buffer.from(bytes).toString("base64");
    }
    if (typeof globalThis.window !== "undefined") {
      const base64Chars =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
      let result = "";
      let i = 0;
      while (i < binary.length) {
        const chr1 = binary.charCodeAt(i++);
        const chr2 = binary.charCodeAt(i++);
        const chr3 = binary.charCodeAt(i++);
        const enc1 = chr1 >> 2;
        const enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
        let enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
        let enc4 = chr3 & 63;
        if (Number.isNaN(chr2)) {
          enc3 = enc4 = 64;
        } else if (Number.isNaN(chr3)) {
          enc4 = 64;
        }
        result +=
          base64Chars.charAt(enc1) +
          base64Chars.charAt(enc2) +
          base64Chars.charAt(enc3) +
          base64Chars.charAt(enc4);
      }
      return result;
    }
  }

  throw new Error("Base64 encoding is not supported in this environment.");
};

const getHotelImageUrl = (hotel) => {
  if (!hotel) return null;
  if (Array.isArray(hotel.propertyphoto) && hotel.propertyphoto.length > 0) {
    return hotel.propertyphoto[0];
  }
  if (typeof hotel.propertyphoto === "string" && hotel.propertyphoto.trim()) {
    return hotel.propertyphoto;
  }
  if (hotel.roomimage) {
    return hotel.roomimage;
  }
  return null;
};

// Update the PackagePDF component
const PlutoToursPDF = ({
  packageSummary,
  showMargin,
  showDiscount,
  discountAmount,
  cabImages,
  activeDiscountPercentage,
  finalTotal,
  getCurrentMarginPercentage,
  companyName = "PTW Holidays",
  selectedLead,
  colorTheme,
}) => {
  const [destinationImages, setDestinationImages] = useState([]);
  const [hotelImageCache, setHotelImageCache] = useState({});
  const [cabImageCache, setCabImageCache] = useState({});
  
  // Helper function to find cab image by matching cabName or cabType
  const findCabImage = useCallback((cabName, cabType) => {
    if (!cabImages || !Array.isArray(cabImages) || cabImages.length === 0) {
      return null;
    }

    const normalizedCabName = (cabName || "").toLowerCase().trim();
    const normalizedCabType = (cabType || "").toLowerCase().trim();

    // First, try to match by cabName (case-insensitive, partial matching)
    if (normalizedCabName) {
      const nameMatch = cabImages.find((cab) => {
        const normalizedImageCabName = (cab.cabName || "").toLowerCase().trim();
        
        // Exact match
        if (normalizedImageCabName === normalizedCabName) {
          return true;
        }
        
        // Partial match - check if history cabName is contained in image cabName or vice versa
        if (normalizedImageCabName.includes(normalizedCabName) || 
            normalizedCabName.includes(normalizedImageCabName)) {
          return true;
        }
        
        // Word-by-word matching (e.g., "Innova Crysta" matches "Crysta" or "Innova")
        const historyWords = normalizedCabName.split(/\s+/);
        const imageWords = normalizedImageCabName.split(/\s+/);
        
        // Check if any word from history matches any word from image
        return historyWords.some(word => 
          word.length > 2 && imageWords.some(imgWord => 
            imgWord.includes(word) || word.includes(imgWord)
          )
        );
      });

      if (nameMatch && nameMatch.cabImages && nameMatch.cabImages.length > 0) {
        return nameMatch.cabImages[0];
      }
    }

    // If no name match, try to match by cabType (case-insensitive)
    if (normalizedCabType) {
      const typeMatch = cabImages.find((cab) => {
        const normalizedImageCabType = (cab.cabType || "").toLowerCase().trim();
        return normalizedImageCabType === normalizedCabType;
      });

      if (typeMatch && typeMatch.cabImages && typeMatch.cabImages.length > 0) {
        return typeMatch.cabImages[0];
      }
    }

    return null;
  }, [cabImages]);

  useEffect(() => {
    const getDestinationImages = () => {
      try {
        // Get the state from package data
        const packageState = packageSummary.package?.state || "";
        
        // Try to match state with state names from images.jsx
        const stateName = findMatchingState(packageState);
        
        if (stateName) {
          // Get images for the matched state
          const images = getStateImages(stateName);
          setDestinationImages(images);
        } else {
          // Fallback to default images if no state match found
          setDestinationImages([
            "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223741/himaclahimg2_cs0qvm.jpg",
            "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223742/himaclahimg3_klatkm.jpg",
            "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223742/himaclahimg4_ujs3z9.jpg",
          ]);
        }
      } catch (error) {
        console.error("Error getting images:", error);
        // Fallback to default images
        setDestinationImages([
          "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223741/himaclahimg2_cs0qvm.jpg",
          "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223742/himaclahimg3_klatkm.jpg",
          "https://res.cloudinary.com/dcp1ev1uk/image/upload/v1724223742/himaclahimg4_ujs3z9.jpg",
        ]);
      }
    };

    getDestinationImages();
  }, [packageSummary.package?.state]);

  const fetchImageAsDataUri = async (imageUrl) => {
    if (!imageUrl) return null;

    const sanitizedUrl = imageUrl.replace(/^https?:\/\//, "");
    const weservBase = `https://images.weserv.nl/?url=${encodeURIComponent(
      `ssl:${sanitizedUrl}`
    )}`;
    const attempts = [
      {
        url: `${weservBase}&output=jpg`,
        label: "weserv-jpg",
      },
      {
        url: `${weservBase}&n=-1`,
        label: "weserv-raw",
      },
      {
        url: `https://api.allorigins.win/raw?url=${encodeURIComponent(imageUrl)}`,
        label: "allorigins",
      },
      {
        url: `https://cors.isomorphic-git.org/${imageUrl}`,
        label: "isomorphic-git",
      },
    ];

    for (const attempt of attempts) {
      try {
        const response = await fetch(attempt.url, {
          mode: "cors",
          cache: "no-store",
        });
        if (!response.ok) {
          throw new Error(`Failed to load image (${attempt.label}) ${response.status}`);
        }
        const buffer = await response.arrayBuffer();
        const contentType =
          response.headers.get("content-type") || "image/jpeg";
        const base64 = arrayBufferToBase64(buffer);
        console.log("PlutoToursPDF image fetched", {
          source: imageUrl,
          via: attempt.label,
        });
        return `data:${contentType};base64,${base64}`;
      } catch (error) {
        console.warn("Image fetch attempt failed", {
          source: imageUrl,
          via: attempt.label,
          error,
        });
      }
    }

    throw new Error("All image fetch attempts failed");
  };

  useEffect(() => {
    const preloadHotelImages = async () => {
      if (!packageSummary?.hotels) {
        setHotelImageCache({});
        return;
      }

      const cacheEntries = await Promise.all(
        packageSummary.hotels.map(async (hotel, index) => {
          const imageUrl = getHotelImageUrl(hotel);
          if (!imageUrl) return [index, null];
          try {
            const dataUri = await fetchImageAsDataUri(imageUrl);
            console.log("PlutoToursPDF hotel image cached", {
              propertyName: hotel?.propertyName,
              source: imageUrl,
              viaProxy: dataUri?.startsWith("data:"),
              cacheKey: index,
            });
            return [index, dataUri];
          } catch (error) {
            console.error("Failed to cache hotel image", {
              propertyName: hotel?.propertyName,
              imageUrl,
              error,
            });
            return [index, null];
          }
        })
      );

      const newCache = {};
      cacheEntries.forEach(([index, dataUri]) => {
        newCache[index] = dataUri;
      });
      setHotelImageCache(newCache);
    };

    preloadHotelImages();
  }, [packageSummary?.hotels]);

  useEffect(() => {
    const preloadCabImages = async () => {
      if (!packageSummary?.transfer?.details || !Array.isArray(packageSummary.transfer.details)) {
        setCabImageCache({});
        return;
      }

      const cacheEntries = await Promise.all(
        packageSummary.transfer.details.map(async (cab, index) => {
          const imageUrl = findCabImage(cab?.cabName, cab?.cabType);
          if (!imageUrl) return [index, null];
          try {
            const dataUri = await fetchImageAsDataUri(imageUrl);
            console.log("PlutoToursPDF cab image cached", {
              cabName: cab?.cabName,
              cabType: cab?.cabType,
              source: imageUrl,
              viaProxy: dataUri?.startsWith("data:"),
              cacheKey: index,
            });
            return [index, dataUri];
          } catch (error) {
            console.error("Failed to cache cab image", {
              cabName: cab?.cabName,
              cabType: cab?.cabType,
              imageUrl,
              error,
            });
            return [index, null];
          }
        })
      );

      const newCache = {};
      cacheEntries.forEach(([index, dataUri]) => {
        newCache[index] = dataUri;
      });
      setCabImageCache(newCache);
    };

    preloadCabImages();
  }, [packageSummary?.transfer?.details, findCabImage]);

  // Helper function to find matching state from package state
  const findMatchingState = (packageState) => {
    const lowerPackageState = packageState.toLowerCase();
    
    // Check each state name to see if it matches
    for (const stateName of Object.keys(stateImages)) {
      const lowerStateName = stateName.toLowerCase();
      
      // Check if state name matches exactly or is contained in package state
      if (lowerPackageState === lowerStateName || lowerPackageState.includes(lowerStateName)) {
        return stateName;
      }
    }
    
    return null;
  };
  // Define color schemes
  const colors = {
    default: {
      primary: "#2d2d44",
      secondary: "#1E293B",
      accent: "#3B82F6",
      light: "#E2E8F0",
      background: "#F8FAFC",
    },
    orange: {
      primary: "#EA580C", // Orange-600
      secondary: "#C2410C", // Orange-700
      accent: "#F97316", // Orange-500
      light: "#FFEDD5", // Orange-100
      background: "#FFF7ED", // Orange-50
    },
  };

  // Use the selected color scheme
  const theme = colorTheme === "orange" ? colors.orange : colors.default;

  // Update styles to use the theme colors
  const styles = {
    header: {
      backgroundColor: theme.primary,
      // ... other styles
    },
    title: {
      color: theme.secondary,
      // ... other styles
    },
    // ... update other style objects to use theme colors
  };

  const itineraryDays = packageSummary.package?.itineraryDays || [];

  const getHotelForDay = (dayObj) => {
    if (!dayObj || !packageSummary?.hotels) return null;
    return packageSummary.hotels.find(
      (hotel) => String(hotel.day) === String(dayObj.day)
    );
  };

  const getHotelImageForDay = (dayObj) => {
    if (!dayObj || !packageSummary?.hotels) return null;
    const hotelIndex = packageSummary.hotels.findIndex(
      (hotel) => String(hotel.day) === String(dayObj.day)
    );
    if (hotelIndex === -1) return null;
    return hotelImageCache[hotelIndex] || null;
  };

  const getConsecutiveHotelIndices = (startIndex, propertyName) => {
    const indices = [];
    if (!propertyName) return indices;
    for (let i = startIndex; i < itineraryDays.length; i += 1) {
      const hotelAtIndex = getHotelForDay(itineraryDays[i]);
      if (hotelAtIndex?.propertyName === propertyName) {
        indices.push(i);
      } else {
        break;
      }
    }
    return indices;
  };

  // Helper function to get grouped hotels for the "Your Hotels" section
  const getGroupedHotels = () => {
    if (!packageSummary?.hotels || !itineraryDays) return [];
    
    const grouped = [];
    const processedHotels = new Set();
    
    itineraryDays.forEach((day, dayIndex) => {
      const hotel = getHotelForDay(day);
      if (!hotel || processedHotels.has(hotel.propertyName)) return;
      
      const consecutiveIndices = getConsecutiveHotelIndices(dayIndex, hotel.propertyName);
      if (consecutiveIndices.length > 0) {
        processedHotels.add(hotel.propertyName);
        
        // Calculate check-in date
        const startDate = selectedLead?.travelDate
          ? new Date(selectedLead.travelDate)
          : new Date();
        const checkInDate = new Date(startDate);
        checkInDate.setDate(startDate.getDate() + consecutiveIndices[0]);
        
        // Get night badges
        const nightBadges = consecutiveIndices.map(idx => formatOrdinal(idx + 1));
        
        // Get hotel image
        const hotelIndex = packageSummary.hotels.findIndex(
          h => h.propertyName === hotel.propertyName
        );
        const hotelImage = hotelIndex !== -1 ? hotelImageCache[hotelIndex] : null;
        
        grouped.push({
          hotel,
          nightBadges,
          checkInDate,
          hotelImage,
          consecutiveIndices,
          city: hotel.cityName || hotel.hotelCity || day.selectedItinerary?.cityName || "",
        });
      }
    });
    
    return grouped;
  };

  const formatOrdinal = (number) => {
    const n = Number(number);
    if (Number.isNaN(n)) return `${number}`;
    const remainder100 = n % 100;
    if (remainder100 >= 11 && remainder100 <= 13) {
      return `${n}th`;
    }
    switch (n % 10) {
      case 1:
        return `${n}st`;
      case 2:
        return `${n}nd`;
      case 3:
        return `${n}rd`;
      default:
        return `${n}th`;
    }
  };

  const formatDisplayDate = (date) => {
    try {
      return date.toLocaleDateString("en-US", {
        day: "numeric",
        month: "long",
      });
    } catch (error) {
      return date.toDateString();
    }
  };

  const getStarDisplay = (rating) => {
    const parsed = Math.round(Number(rating) || 0);
    if (!parsed) return null;
    return "â˜…".repeat(parsed);
  };

  const accommodationStyles = {
    card: {
      backgroundColor: "#FFFFFF",
      borderRadius: 8,
      borderWidth: 1,
      borderColor: "#E2E8F0",
      padding: 14,
      marginTop: 10,
      flexDirection: "row",
      justifyContent: "space-between",
      gap: 12,
    },
    leftColumn: {
      flex: 1,
      flexDirection: "column",
      gap: 8,
    },
    badgeWrapper: {
      flexDirection: "row",
      alignItems: "center",
      flexWrap: "wrap",
      gap: 6,
    },
    badge: {
      backgroundColor: "#DBEAFE",
      borderRadius: 6,
      paddingHorizontal: 10,
      paddingVertical: 4,
      borderWidth: 1,
      borderColor: "#BFDBFE",
    },
    badgeText: {
      fontSize: 10,
      fontWeight: "600",
      color: "#1D4ED8",
    },
    nightsText: {
      fontSize: 11,
      color: "#1F2937",
    },
    nightsCity: {
      fontWeight: "bold",
      color: "#0F172A",
    },
    subText: {
      fontSize: 9,
      color: "#6B7280",
    },
    hotelName: {
      fontSize: 13,
      fontWeight: "bold",
      color: "#1E40AF",
    },
    starText: {
      fontSize: 10,
      color: "#F59E0B",
    },
    infoRow: {
      flexDirection: "row",
      gap: 24,
      marginTop: 6,
    },
    infoColumn: {
      minWidth: 90,
    },
    infoHeading: {
      fontSize: 8,
      color: "#94A3B8",
      letterSpacing: 1,
      marginBottom: 4,
    },
    infoValue: {
      fontSize: 10,
      fontWeight: "600",
      color: "#1F2937",
      textTransform: "capitalize",
    },
    secondaryValue: {
      fontSize: 9,
      color: "#475569",
      marginTop: 2,
    },
    similarLabel: {
      fontSize: 10,
      fontWeight: "600",
      color: "#1E40AF",
      marginTop: 6,
      marginBottom: 2,
    },
    similarValue: {
      fontSize: 10,
      color: "#1F2937",
    },
    imageWrapper: {
      width: 140,
      height: 110,
      borderRadius: 10,
      overflow: "hidden",
      borderWidth: 1,
      borderColor: "#E2E8F0",
    },
    placeholder: {
      width: 140,
      height: 110,
      borderRadius: 10,
      borderWidth: 1,
      borderColor: "#E2E8F0",
      alignItems: "center",
      justifyContent: "center",
      backgroundColor: "#F8FAFC",
    },
    placeholderText: {
      fontSize: 8,
      color: "#94A3B8",
    },
  };

  return (
    <Document>
      {/* First Page - Main Content */}
      <Page
        size="A4"
        style={{
          ...pdfStyles.page,
          paddingTop: 20,
          paddingBottom: 40,
          paddingLeft: 20,
          paddingRight: 20,
          backgroundColor: "#ffffff",
          position: "relative",
        }}
        wrap={true}
        break={true}
      >
        {/* Main Content Container */}
        <View
          style={{
            flex: 1,
            marginBottom: 20,
          }}
        >
          {/* Modern Professional Header */}
          <View
            style={{
              padding: 20,
              borderBottomLeftRadius: 16,
              borderBottomRightRadius: 16,
              marginBottom: 16,
              position: "relative",
              overflow: "hidden",
              backgroundColor: "#2b6887",
            }}
          >
            {/* Background Pattern */}
            <View
              style={{
                position: "absolute",
                top: -50,
                right: -50,
                width: 200,
                height: 200,
                backgroundColor: "#2b6887",
                borderRadius: 100,
                opacity: 0.3,
              }}
            />
            <View
              style={{
                position: "absolute",
                bottom: -30,
                left: -30,
                width: 150,
                height: 150,
                backgroundColor: "rgba(255, 255, 255, 0.05)",
                borderRadius: 75,
                opacity: 0.2,
              }}
            />

            {/* Top Brand Section */}
            <View
              style={{
                flexDirection: "row",
                justifyContent: "space-between",
                alignItems: "center",
                marginBottom: 20,
                paddingBottom: 16,
                borderBottomWidth: 1,
                borderBottomColor: "rgba(255, 255, 255, 0.2)",
              }}
            >
              {/* Company Info */}
              <View
                style={{
                  flexDirection: "row",
                  alignItems: "center",
                  gap: 12,
                }}
              >
                <View
                  style={{
                    width: 50,
                    height: 50,
                    backgroundColor: "rgba(255, 255, 255, 0.2)",
                    borderRadius: 12,
                    alignItems: "center",
                    justifyContent: "center",
                    backdropFilter: "blur(10px)",
                  }}
                >
                  <Image
                    style={{
                      width: 35,
                      height: 35,
                      objectFit: "contain",
                    }}
                    source="https://res.cloudinary.com/dcp1ev1uk/image/upload/v1749216057/jhjhgjhgjg_i8ti9h.png"
                  />
                </View>
                <View>
                  <Text
                    style={{
                      fontSize: 18,
                      fontWeight: "bold",
                      color: "#FFFFFF",
                      marginBottom: 2,
                    }}
                  >
                    PTW Holidays Pvt. Ltd.
                  </Text>
                  <Text
                    style={{
                      fontSize: 11,
                      color: "rgba(255, 255, 255, 0.8)",
                      fontWeight: "500",
                    }}
                  >
                    Your Trusted Travel Partner
                  </Text>
                </View>
              </View>

              {/* Contact Info */}
              <View
                style={{
                  alignItems: "flex-end",
                  gap: 6,
                }}
              >
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 6,
                    backgroundColor: "rgba(255, 255, 255, 0.1)",
                    paddingHorizontal: 12,
                    paddingVertical: 6,
                    borderRadius: 20,
                    backdropFilter: "blur(10px)",
                  }}
                >
                  <View style={{ width: 12, height: 12 }}>
                    <Icons.Email width={12} height={12} color="#FFFFFF" />
                  </View>
                  <Text
                    style={{
                      fontSize: 10,
                      color: "#FFFFFF",
                      fontWeight: "500",
                    }}
                  >
                    info@ptwholidays.com
                  </Text>
                </View>
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 6,
                    backgroundColor: "rgba(255, 255, 255, 0.1)",
                    paddingHorizontal: 12,
                    paddingVertical: 6,
                    borderRadius: 20,
                    backdropFilter: "blur(10px)",
                  }}
                >
                  <View style={{ width: 12, height: 12 }}>
                    <Icons.Phone width={12} height={12} color="#FFFFFF" />
                  </View>
                  <Text
                    style={{
                      fontSize: 10,
                      color: "#FFFFFF",
                      fontWeight: "500",
                    }}
                  >
                    +91-8353056000
                  </Text>
                </View>
              </View>
            </View>

            {/* Main Header Content */}
            <View
              style={{
                flexDirection: "row",
                justifyContent: "space-between",
                alignItems: "flex-end",
              }}
            >
              {/* Left Section - Customer & Package Info */}
              <View style={{ flex: 0.65 }}>
                {/* Customer Welcome */}
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 8,
                    marginBottom: 8,
                  }}
                >
                  <View
                    style={{
                      width: 24,
                      height: 24,
                      backgroundColor: "rgba(255, 255, 255, 0.2)",
                      borderRadius: 12,
                      alignItems: "center",
                      justifyContent: "center",
                    }}
                  >
                    <View style={{ width: 14, height: 14 }}>
                      <Icons.User width={14} height={14} color="#FFFFFF" />
                    </View>
                  </View>
                  <Text
                    style={{
                      fontSize: 14,
                      color: "rgba(255, 255, 255, 0.9)",
                      fontWeight: "500",
                    }}
                  >
                    Personalized for
                  </Text>
                  <Text
                    style={{
                      fontSize: 16,
                      fontWeight: "bold",
                      color: "#FFFFFF",
                    }}
                  >
                    {selectedLead?.name || "Valued Customer"}
                  </Text>
                </View>

                {/* Package Name */}
                <Text
                  style={{
                    fontSize: 28,
                    fontWeight: "bold",
                    color: "#FFFFFF",
                    marginBottom: 12,
                    lineHeight: 1.2,
                  }}
                >
                  {packageSummary.package?.packageName ||
                    "Exclusive Travel Package"}
                </Text>

                {/* Package Details Row */}
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 12,
                    flexWrap: "wrap",
                  }}
                >
                  {/* Duration Badge */}
                  <View
                    style={{
                      backgroundColor: "rgba(255, 255, 255, 0.2)",
                      paddingHorizontal: 12,
                      paddingVertical: 6,
                      borderRadius: 20,
                      flexDirection: "row",
                      alignItems: "center",
                      gap: 6,
                    }}
                  >
                    <View style={{ width: 12, height: 12 }}>
                      <Icons.Calendar width={12} height={12} color="#FFFFFF" />
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        fontWeight: "600",
                        color: "#FFFFFF",
                      }}
                    >
                      {packageSummary.package?.duration || "5N/6D"}
                    </Text>
                  </View>

                  {/* Package Type Badge */}
                  <View
                    style={{
                      backgroundColor: "rgba(255, 255, 255, 0.15)",
                      paddingHorizontal: 12,
                      paddingVertical: 6,
                      borderRadius: 20,
                      flexDirection: "row",
                      alignItems: "center",
                      gap: 6,
                    }}
                  >
                    <View style={{ width: 12, height: 12 }}>
                      <Icons.Star width={12} height={12} color="#FFFFFF" />
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        fontWeight: "600",
                        color: "#FFFFFF",
                      }}
                    >
                      {packageSummary.package?.packageType || "Premium Package"}
                    </Text>
                  </View>

                  {/* Customizable Badge */}
                  <View
                    style={{
                      backgroundColor: packageSummary.package
                        ?.customizablePackage
                        ? "rgba(34, 197, 94, 0.3)"
                        : "rgba(239, 68, 68, 0.3)",
                      paddingHorizontal: 12,
                      paddingVertical: 6,
                      borderRadius: 20,
                      flexDirection: "row",
                      alignItems: "center",
                      gap: 6,
                    }}
                  >
                    <View style={{ width: 12, height: 12 }}>
                      <Icons.Check width={12} height={12} color="#FFFFFF" />
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        fontWeight: "600",
                        color: "#FFFFFF",
                      }}
                    >
                      {packageSummary.package?.customizablePackage
                        ? "Customizable"
                        : "Fixed"}
                    </Text>
                  </View>
                </View>
              </View>

              {/* Right Section - Pricing */}
              <View
                style={{
                  flex: 0.3,
                  alignItems: "flex-end",
                  backgroundColor: "rgba(255, 255, 255, 0.1)",
                  padding: 16,
                  borderRadius: 16,
                  backdropFilter: "blur(10px)",
                  borderWidth: 1,
                  borderColor: "rgba(255, 255, 255, 0.2)",
                }}
              >
                <Text
                  style={{
                    fontSize: 12,
                    color: "rgba(255, 255, 255, 0.8)",
                    marginBottom: 4,
                    fontWeight: "500",
                  }}
                >
                  Total Package Cost
                </Text>
                <Text
                  style={{
                    fontSize: 10,
                    color: "rgba(255, 255, 255, 0.8)",
                    marginBottom: 4,
                    fontWeight: "500",
                  }}
                >
                  With 5% GST included
                </Text>
                <Text
                  style={{
                    fontSize: 32,
                    fontWeight: "bold",
                    color: "#FFFFFF",
                    marginBottom: 4,
                  }}
                >
                  Rs.
                  {showMargin
                    ? finalTotal.toFixed(0)
                    : packageSummary.totals.grandTotal}
                </Text>

                {activeDiscountPercentage > 0 && (
                  <View
                    style={{
                      backgroundColor: "rgba(34, 197, 94, 0.3)",
                      paddingHorizontal: 8,
                      paddingVertical: 4,
                      borderRadius: 12,
                      marginBottom: 8,
                    }}
                  >
                    <Text
                      style={{
                        fontSize: 10,
                        color: "#FFFFFF",
                        fontWeight: "600",
                      }}
                    >
                      {activeDiscountPercentage}% OFF Applied
                    </Text>
                  </View>
                )}

                <View
                  style={{
                    flexDirection: "row",
                    gap: 8,
                    marginTop: 8,
                    paddingTop: 8,
                    borderTopWidth: 1,
                    borderTopColor: "rgba(255, 255, 255, 0.2)",
                  }}
                >
                  <View
                    style={{
                      backgroundColor: "rgba(255, 255, 255, 0.2)",
                      paddingHorizontal: 8,
                      paddingVertical: 4,
                      borderRadius: 8,
                    }}
                  >
                    <Text
                      style={{
                        fontSize: 9,
                        color: "#FFFFFF",
                        fontWeight: "500",
                      }}
                    >
                      Adults: {selectedLead?.adults || "0"}
                    </Text>
                  </View>
                  <View
                    style={{
                      backgroundColor: "rgba(255, 255, 255, 0.2)",
                      paddingHorizontal: 8,
                      paddingVertical: 4,
                      borderRadius: 8,
                    }}
                  >
                    <Text
                      style={{
                        fontSize: 9,
                        color: "#FFFFFF",
                        fontWeight: "500",
                      }}
                    >
                      Children: {selectedLead?.kids || "0"}
                    </Text>
                  </View>
                </View>
              </View>
            </View>
          </View>

          {/* Image Gallery Section */}
          <View
            style={{
              flexDirection: "row",
              gap: 8,
              marginVertical: 16,
              marginHorizontal: 0,
            }}
          >
            {destinationImages.map((imageUrl, index) => (
              <View
                key={index}
                style={{
                  flex: 1,
                  height: 150,
                  borderRadius: 8,
                  overflow: "hidden",
                  borderWidth: 1,
                  borderColor: "#E2E8F0",
                }}
              >
                <Image
                  source={imageUrl}
                  style={{
                    width: "100%",
                    height: "100%",
                    objectFit: "cover",
                  }}
                />
              </View>
            ))}
          </View>

          {/* Enhanced Lead Details Section */}
          <View style={{
            marginBottom: 16,
            backgroundColor: "#FFFFFF",
            borderRadius: 12,
            borderWidth: 1,
            borderColor: "#E2E8F0",
            overflow: "hidden",
            shadowColor: "#000",
            shadowOffset: { width: 0, height: 2 },
            shadowOpacity: 0.05,
            shadowRadius: 4,
          }}>
            {/* Beautiful Header */}
            <View
              style={{
                backgroundColor: "#2d2d44",
                paddingTop: 14,
                paddingBottom: 14,
                paddingLeft: 16,
                paddingRight: 16,
                flexDirection: "row",
                alignItems: "center",
                gap: 12,
                position: "relative",
                overflow: "hidden",
              }}
            >
              {/* Decorative Background Elements */}
              <View
                style={{
                  position: "absolute",
                  top: -30,
                  right: -30,
                  width: 100,
                  height: 100,
                  backgroundColor: "rgba(255, 255, 255, 0.05)",
                  borderRadius: 50,
                }}
              />
              <View
                style={{
                  position: "absolute",
                  bottom: -20,
                  left: -20,
                  width: 80,
                  height: 80,
                  backgroundColor: "rgba(255, 255, 255, 0.03)",
                  borderRadius: 40,
                }}
              />
              
              {/* Icon Container */}
              <View
                style={{
                  width: 40,
                  height: 40,
                  backgroundColor: "rgba(255, 255, 255, 0.15)",
                  borderRadius: 10,
                  alignItems: "center",
                  justifyContent: "center",
                  position: "relative",
                  zIndex: 2,
                }}
              >
                <View style={{ width: 20, height: 20 }}>
                  <Icons.User width={20} height={20} color="#FFFFFF" />
                </View>
              </View>
              
              {/* Title */}
              <View style={{ flex: 1, position: "relative", zIndex: 2 }}>
                <Text
                  style={{
                    fontSize: 16,
                    fontWeight: "bold",
                    color: "#FFFFFF",
                    letterSpacing: 0.5,
                    marginBottom: 2,
                  }}
                >
                  Your Details
                </Text>
                <Text
                  style={{
                    fontSize: 10,
                    color: "rgba(255, 255, 255, 0.7)",
                    fontWeight: "500",
                  }}
                >
                  Your travel information
                </Text>
              </View>
            </View>

            {/* Content Section */}
            <View
              style={{
                paddingTop: 16,
                paddingBottom: 16,
                paddingLeft: 16,
                paddingRight: 16,
                backgroundColor: "#FFFFFF",
              }}
            >
              <View
                style={{
                  flexDirection: "row",
                  flexWrap: "wrap",
                  gap: 12,
                }}
              >
                {/* Personal Info Card */}
                <View style={{ 
                  flex: 1, 
                  minWidth: 200,
                  backgroundColor: "#F8FAFC",
                  padding: 14,
                  borderRadius: 10,
                  borderWidth: 1,
                  borderColor: "#E2E8F0",
                  borderLeftWidth: 4,
                  borderLeftColor: "#3B82F6",
                }}>
                  <View style={{ flexDirection: "row", alignItems: "center", marginBottom: 12, gap: 6 }}>
                    <View style={{ 
                      width: 24, 
                      height: 24, 
                      backgroundColor: "#DBEAFE", 
                      borderRadius: 6,
                      alignItems: "center",
                      justifyContent: "center",
                    }}>
                      <View style={{ width: 12, height: 12 }}>
                        <Icons.Profile width={12} height={12} color="#3B82F6" />
                      </View>
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        color: "#1E293B",
                        fontWeight: "bold",
                        letterSpacing: 0.3,
                      }}
                    >
                      Personal Information
                    </Text>
                  </View>
                  <View style={{ gap: 8 }}>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Name:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.name || "N/A"}
                      </Text>
                    </View>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Contact:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.mobile || "N/A"}
                      </Text>
                    </View>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Email:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.email || "N/A"}
                      </Text>
                    </View>
                  </View>
                </View>

                {/* Travel Info Card */}
                <View style={{ 
                  flex: 1, 
                  minWidth: 200,
                  backgroundColor: "#F8FAFC",
                  padding: 14,
                  borderRadius: 10,
                  borderWidth: 1,
                  borderColor: "#E2E8F0",
                  borderLeftWidth: 4,
                  borderLeftColor: "#10B981",
                }}>
                  <View style={{ flexDirection: "row", alignItems: "center", marginBottom: 12, gap: 6 }}>
                    <View style={{ 
                      width: 24, 
                      height: 24, 
                      backgroundColor: "#D1FAE5", 
                      borderRadius: 6,
                      alignItems: "center",
                      justifyContent: "center",
                    }}>
                      <View style={{ width: 12, height: 12 }}>
                        <Icons.Calendar width={12} height={12} color="#10B981" />
                      </View>
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        color: "#1E293B",
                        fontWeight: "bold",
                        letterSpacing: 0.3,
                      }}
                    >
                      Travel Information
                    </Text>
                  </View>
                  <View style={{ gap: 8 }}>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Date:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.travelDate
                          ? new Date(
                              selectedLead.travelDate
                            ).toLocaleDateString()
                          : "N/A"}
                      </Text>
                    </View>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Duration:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.nights || "0"} Nights /{" "}
                        {selectedLead?.days || "0"} Days
                      </Text>
                    </View>
                    <View style={{ flexDirection: "row", gap: 8, alignItems: "flex-start" }}>
                      <Text
                        style={{ 
                          fontSize: 9, 
                          color: "#64748B", 
                          width: 65,
                          fontWeight: "500",
                        }}
                      >
                        Package:
                      </Text>
                      <Text style={{ 
                        fontSize: 10, 
                        color: "#1E293B", 
                        flex: 1,
                        fontWeight: "600",
                      }}>
                        {selectedLead?.packageType || "N/A"}
                      </Text>
                    </View>
                  </View>
                </View>

                {/* Guest Info Card */}
                <View style={{ 
                  flex: 1, 
                  minWidth: 200,
                  backgroundColor: "#F8FAFC",
                  padding: 14,
                  borderRadius: 10,
                  borderWidth: 1,
                  borderColor: "#E2E8F0",
                  borderLeftWidth: 4,
                  borderLeftColor: "#F59E0B",
                }}>
                  <View style={{ flexDirection: "row", alignItems: "center", marginBottom: 12, gap: 6 }}>
                    <View style={{ 
                      width: 24, 
                      height: 24, 
                      backgroundColor: "#FEF3C7", 
                      borderRadius: 6,
                      alignItems: "center",
                      justifyContent: "center",
                    }}>
                      <View style={{ width: 12, height: 12 }}>
                        <Icons.Group width={12} height={12} color="#F59E0B" />
                      </View>
                    </View>
                    <Text
                      style={{
                        fontSize: 11,
                        color: "#1E293B",
                        fontWeight: "bold",
                        letterSpacing: 0.3,
                      }}
                    >
                      Guest Information
                    </Text>
                  </View>
                  <View
                    style={{ 
                      flexDirection: "row", 
                      flexWrap: "wrap", 
                      gap: 10,
                    }}
                  >
                    <View
                      style={{ 
                        flexDirection: "row", 
                        gap: 6, 
                        backgroundColor: "#FFFFFF",
                        paddingVertical: 6,
                        paddingHorizontal: 10,
                        borderRadius: 6,
                        borderWidth: 1,
                        borderColor: "#E2E8F0",
                        alignItems: "center",
                      }}
                    >
                      <View style={{ width: 10, height: 10 }}>
                        <Icons.Adult width={10} height={10} color="#3B82F6" />
                      </View>
                      <Text style={{ fontSize: 9, color: "#64748B", fontWeight: "500" }}>
                        Adults:
                      </Text>
                      <Text style={{ fontSize: 10, color: "#1E293B", fontWeight: "bold" }}>
                        {selectedLead?.adults || "0"}
                      </Text>
                    </View>
                    <View
                      style={{ 
                        flexDirection: "row", 
                        gap: 6,
                        backgroundColor: "#FFFFFF",
                        paddingVertical: 6,
                        paddingHorizontal: 10,
                        borderRadius: 6,
                        borderWidth: 1,
                        borderColor: "#E2E8F0",
                        alignItems: "center",
                      }}
                    >
                      <View style={{ width: 10, height: 10 }}>
                        <Icons.Child width={10} height={10} color="#10B981" />
                      </View>
                      <Text style={{ fontSize: 9, color: "#64748B", fontWeight: "500" }}>
                        Children:
                      </Text>
                      <Text style={{ fontSize: 10, color: "#1E293B", fontWeight: "bold" }}>
                        {selectedLead?.kids || "0"}
                      </Text>
                    </View>
                    <View
                      style={{ 
                        flexDirection: "row", 
                        gap: 6,
                        backgroundColor: "#FFFFFF",
                        paddingVertical: 6,
                        paddingHorizontal: 10,
                        borderRadius: 6,
                        borderWidth: 1,
                        borderColor: "#E2E8F0",
                        alignItems: "center",
                      }}
                    >
                      <View style={{ width: 10, height: 10 }}>
                        <Icons.Room width={10} height={10} color="#F59E0B" />
                      </View>
                      <Text style={{ fontSize: 9, color: "#64748B", fontWeight: "500" }}>
                        Rooms:
                      </Text>
                      <Text style={{ fontSize: 10, color: "#1E293B", fontWeight: "bold" }}>
                        {selectedLead?.noOfRooms || "0"}
                      </Text>
                    </View>
                  </View>
                </View>
              </View>
            </View>
          </View>
          {/* Enhanced Package Description Section */}
          <View style={{
            marginBottom: 16,
            marginTop: 0,
            backgroundColor: "#FFFFFF",
            borderRadius: 12,
            borderWidth: 1,
            borderColor: "#E2E8F0",
            overflow: "hidden",
            shadowColor: "#000",
            shadowOffset: { width: 0, height: 2 },
            shadowOpacity: 0.05,
            shadowRadius: 4,
          }}>
            {/* Beautiful Header */}
            <View
              style={{
                backgroundColor: "#2d2d44",
                paddingTop: 14,
                paddingBottom: 14,
                paddingLeft: 16,
                paddingRight: 16,
                flexDirection: "row",
                alignItems: "center",
                gap: 12,
                position: "relative",
                overflow: "hidden",
              }}
            >
              {/* Decorative Background Elements */}
              <View
                style={{
                  position: "absolute",
                  top: -30,
                  right: -30,
                  width: 100,
                  height: 100,
                  backgroundColor: "rgba(255, 255, 255, 0.05)",
                  borderRadius: 50,
                }}
              />
              <View
                style={{
                  position: "absolute",
                  bottom: -20,
                  left: -20,
                  width: 80,
                  height: 80,
                  backgroundColor: "rgba(255, 255, 255, 0.03)",
                  borderRadius: 40,
                }}
              />
              
              {/* Icon Container */}
              <View
                style={{
                  width: 40,
                  height: 40,
                  backgroundColor: "rgba(255, 255, 255, 0.15)",
                  borderRadius: 10,
                  alignItems: "center",
                  justifyContent: "center",
                  position: "relative",
                  zIndex: 2,
                }}
              >
                <View style={{ width: 20, height: 20 }}>
                  <Icons.Document width={20} height={20} color="#FFFFFF" />
                </View>
              </View>
              
              {/* Title */}
              <View style={{ flex: 1, position: "relative", zIndex: 2 }}>
                <Text
                  style={{
                    fontSize: 16,
                    fontWeight: "bold",
                    color: "#FFFFFF",
                    letterSpacing: 0.5,
                    marginBottom: 2,
                  }}
                >
                  Package Description
                </Text>
                <Text
                  style={{
                    fontSize: 10,
                    color: "rgba(255, 255, 255, 0.7)",
                    fontWeight: "500",
                  }}
                >
                  Discover what awaits you
                </Text>
              </View>
            </View>

            {/* Content Section */}
            {packageSummary?.package?.packageDescription && (
              <View
                style={{
                  paddingTop: 16,
                  paddingBottom: 16,
                  paddingLeft: 16,
                  paddingRight: 16,
                  backgroundColor: "#FFFFFF",
                  position: "relative",
                }}
              >
                {/* Decorative Quote Symbol */}
                <View
                  style={{
                    position: "absolute",
                    top: 8,
                    left: 8,
                    width: 40,
                    height: 40,
                    opacity: 0.08,
                  }}
                >
                  <Text
                    style={{
                      fontSize: 50,
                      color: "#2d2d44",
                      fontFamily: "Helvetica-Bold",
                    }}
                  >
                    "
                  </Text>
                </View>

                {/* Description Content */}
                <View style={{ paddingTop: 4 }}>
                  {parseHtmlContent(packageSummary.package.packageDescription).map((textSegments, idx) => (
                    <View
                      key={idx}
                      style={{
                        marginBottom: idx < parseHtmlContent(packageSummary.package.packageDescription).length - 1 ? 10 : 0,
                        paddingLeft: 12,
                        borderLeftWidth: 3,
                        borderLeftColor: "#DBEAFE",
                        paddingTop: 6,
                        paddingBottom: 6,
                        paddingRight: 4,
                      }}
                    >
                      <Text
                        style={{
                          fontSize: 11,
                          color: "#1E293B",
                          lineHeight: 1.6,
                          textAlign: "left",
                        }}
                      >
                        {Array.isArray(textSegments) ? (
                          textSegments.map((segment, segIdx) => (
                            <Text 
                              key={segIdx} 
                              style={segment.bold ? { 
                                fontWeight: 'bold', 
                                fontFamily: 'Helvetica-Bold',
                                color: "#2d2d44",
                              } : {
                                color: "#475569",
                              }}
                            >
                              {segment.text}
                            </Text>
                          ))
                        ) : (
                          <Text style={{ color: "#475569" }}>{textSegments}</Text>
                        )}
                      </Text>
                    </View>
                  ))}
                </View>

                {/* Bottom Decorative Line */}
                <View
                  style={{
                    marginTop: 12,
                    height: 2,
                    backgroundColor: "#EFF6FF",
                    borderRadius: 1,
                    position: "relative",
                  }}
                >
                  <View
                    style={{
                      position: "absolute",
                      left: 0,
                      top: 0,
                      width: "25%",
                      height: "100%",
                      backgroundColor: "#2d2d44",
                      borderRadius: 1,
                    }}
                  />
                </View>
              </View>
            )}
          </View>
          {/* Enhanced Itinerary Overview with hotels and cab info */}
          <View
            style={{
              marginTop: 8,
              marginBottom: 12,
              padding: 10,
              backgroundColor: "#F8FAFC",
              borderRadius: 6,
              borderWidth: 1,
              borderColor: "#E2E8F0",
            }}
          >
            <View
              style={{
                flexDirection: "row",
                alignItems: "center",
                marginBottom: 8,
                gap: 6,
              }}
            >
              <View style={{ width: 14, height: 14 }}>
                <Icons.Map width={14} height={14} color="#000000" />
              </View>
              <Text
                style={{
                  fontSize: 11,
                  fontWeight: "bold",
                  color: "#1E293B",
                }}
              >
                Journey Overview
              </Text>
            </View>

            {/* Cities Timeline */}
            <View
              style={{
                flexDirection: "row",
                flexWrap: "wrap",
                gap: 12,
                marginBottom: 12,
                borderBottom: "1px solid #E2E8F0",
                paddingBottom: 12,
              }}
            >
              {packageSummary.package?.itineraryDays?.map((day, index) => {
                const cityInfo = day.selectedItinerary;
                const nextDay =
                  packageSummary.package?.itineraryDays[index + 1];
                const isLastDayInCity =
                  !nextDay ||
                  nextDay.selectedItinerary?.cityName !== cityInfo?.cityName;

                if (
                  index === 0 ||
                  cityInfo?.cityName !==
                    packageSummary.package?.itineraryDays[index - 1]
                      .selectedItinerary?.cityName
                ) {
                  const daysInCity = packageSummary.package?.itineraryDays
                    .slice(index)
                    .filter((d, i, arr) => {
                      if (i === 0) return true;
                      return d.selectedItinerary?.cityName === cityInfo?.cityName;
                    }).length;

                  return (
                    <View
                      key={index}
                      style={{
                        backgroundColor: "#FFFFFF",
                        borderRadius: 4,
                        padding: 8,
                        flexDirection: "row",
                        alignItems: "center",
                        gap: 6,
                        borderWidth: 1,
                        borderColor: "#E2E8F0",
                        minWidth: 120,
                      }}
                    >
                      <View
                        style={{
                          width: 22,
                          height: 22,
                          backgroundColor: "#EFF6FF",
                          borderRadius: 11,
                          alignItems: "center",
                          justifyContent: "center",
                        }}
                      >
                        {/* <Text
                          style={{
                            fontSize: 10,
                            fontWeight: "bold",
                            color: "#2d2d44",
                          }}
                        >
                          {daysInCity}
                        </Text> */}
                      </View>
                      <View style={{ flex: 1 }}>
                        <Text
                          style={{
                            fontSize: 10,
                            fontWeight: "bold",
                            color: "#1E293B",
                          }}
                        >
                          {cityInfo?.cityName}
                        </Text>
                        {/* <Text
                          style={{
                            fontSize: 9,
                            color: "#64748B",
                          }}
                        >
                          {daysInCity} {daysInCity > 1 ? "Days" : "Day"}
                        </Text> */}
                      </View>
                      {!isLastDayInCity && (
                        <View
                          style={{
                            position: "absolute",
                            right: -8,
                            top: "50%",
                            marginTop: -4,
                            width: 6,
                            height: 6,
                            borderWidth: 1.5,
                            borderColor: "#2d2d44",
                            borderRadius: 3,
                            backgroundColor: "#FFFFFF",
                            zIndex: 1,
                          }}
                        />
                      )}
                    </View>
                  );
                }
                return null;
              })}
            </View>

            {/* Hotels and Transport Info with Costs */}
            <View style={{ flexDirection: "column", gap: 10, marginTop: 10 }}>
              {/* Hotels Summary */}
              <View style={{ width: "100%" }}>
                <View
                  style={{
                    backgroundColor: "#FFFFFF",
                    borderRadius: 8,
                    padding: 8,
                    borderWidth: 1,
                    borderColor: "#E2E8F0",
                    shadowColor: "#000",
                    shadowOffset: { width: 0, height: 1 },
                    shadowOpacity: 0.1,
                    shadowRadius: 2,
                  }}
                >
                  <View
                    style={{
                      flexDirection: "row",
                      alignItems: "center",
                      justifyContent: "space-between",
                      marginBottom: 12,
                      borderBottom: "1px solid #E2E8F0",
                      paddingBottom: 8,
                    }}
                  >
                    <View
                      style={{ flexDirection: "row", alignItems: "center" }}
                    >
                      <View style={{ width: 14, height: 14 }}>
                        <Icons.Hotel width={14} height={14} color="#2d2d44" />
                      </View>
                      <Text
                        style={{
                          fontSize: 11,
                          fontWeight: "bold",
                          color: "#1E293B",
                          marginLeft: 5,
                        }}
                      >
                        Your Hotels
                      </Text>
                    </View>
                  </View>

                  {/* Detailed Hotel Cards */}
                  {getGroupedHotels().map((groupedHotel, index) => {
                    const { hotel, nightBadges, checkInDate, hotelImage, city } = groupedHotel;
                    const similarOptions =
                      hotel?.similarHotels ||
                      hotel?.alternateHotels ||
                      hotel?.alternativeHotels;
                    const starRating = hotel.basicInfo?.hotelStarRating || hotel.starRating;
                    
                    return (
                      <View
                        key={index}
                        wrap={false}
                        style={{
                          marginTop: index === 0 ? 10 : 10,
                          marginBottom: 10,
                          minHeight: 140,
                        }}
                      >
                        <View
                          style={[
                            accommodationStyles.card,
                            { 
                              marginTop: 0,
                              marginBottom: 0,
                              minHeight: 140,
                              flexShrink: 0,
                            }
                          ]}
                          wrap={false}
                        >
                          <View style={accommodationStyles.leftColumn}>
                            {/* Night Badges and City */}
                            <View style={accommodationStyles.badgeWrapper}>
                              {nightBadges.map((badge, badgeIndex) => (
                                <View
                                  key={badgeIndex}
                                  style={accommodationStyles.badge}
                                >
                                  <Text style={accommodationStyles.badgeText}>
                                    {badge}
                                  </Text>
                                </View>
                              ))}
                              <Text style={accommodationStyles.nightsText}>
                                Nights at{" "}
                                <Text style={accommodationStyles.nightsCity}>
                                  {city || "Destination"}
                                </Text>
                              </Text>
                            </View>

                            {/* Check-in Date */}
                            <Text style={accommodationStyles.subText}>
                              Check-in on {formatDisplayDate(checkInDate)}
                            </Text>

                            {/* Hotel Name */}
                            <Text style={accommodationStyles.hotelName}>
                              {hotel.propertyName}
                            </Text>

                            {/* Star Rating */}
                            {starRating && getStarDisplay(starRating) && (
                              <Text style={accommodationStyles.starText}>
                                {getStarDisplay(starRating)}
                              </Text>
                            )}

                            {/* ROOMS and MEAL PLAN */}
                            <View style={accommodationStyles.infoRow}>
                              <View style={accommodationStyles.infoColumn}>
                                <Text style={accommodationStyles.infoHeading}>
                                  ROOMS
                                </Text>
                                <Text style={accommodationStyles.infoValue}>
                                  {hotel.roomName || "1 Deluxe Room"}
                                </Text>
                                {(selectedLead?.adults || selectedLead?.noOfRooms) && (
                                  <Text style={accommodationStyles.secondaryValue}>
                                    {selectedLead?.adults || 2} Pax
                                  </Text>
                                )}
                              </View>
                              <View style={accommodationStyles.infoColumn}>
                                <Text style={accommodationStyles.infoHeading}>
                                  MEAL PLAN
                                </Text>
                                <Text style={accommodationStyles.infoValue}>
                                  {hotel.mealPlan || "Breakfast"}
                                </Text>
                              </View>
                            </View>

                            {/* Similar Options */}
                            {Array.isArray(similarOptions) &&
                              similarOptions.length > 0 && (
                                <View>
                                  <Text style={accommodationStyles.similarLabel}>
                                    Similar Options
                                  </Text>
                                  <Text style={accommodationStyles.similarValue}>
                                    {similarOptions
                                      .slice(0, 3)
                                      .map((hotelOption) =>
                                        typeof hotelOption === "string"
                                          ? hotelOption
                                          : hotelOption?.propertyName ||
                                            hotelOption?.name
                                      )
                                      .filter(Boolean)
                                      .join(", ")}
                                  </Text>
                                </View>
                              )}
                          </View>

                          {/* Hotel Image */}
                          {hotelImage ? (
                            <View style={accommodationStyles.imageWrapper}>
                              <Image
                                source={{ uri: hotelImage }}
                                style={{
                                  width: "100%",
                                  height: "100%",
                                  objectFit: "cover",
                                }}
                              />
                            </View>
                          ) : (
                            <View style={accommodationStyles.placeholder}>
                              <Text style={accommodationStyles.placeholderText}>
                                Image unavailable
                              </Text>
                            </View>
                          )}
                        </View>
                      </View>
                    );
                  })}
                </View>
              </View>

              {/* Transport Summary */}
              <View style={{ width: "100%" }}>
                <View
                  style={{
                    backgroundColor: "#FFFFFF",
                    borderRadius: 8,
                    padding: 8,
                    borderWidth: 1,
                    borderColor: "#E2E8F0",
                    shadowColor: "#000",
                    shadowOffset: { width: 0, height: 1 },
                    shadowOpacity: 0.1,
                    shadowRadius: 2,
                  }}
                >
                  <View
                    style={{
                      flexDirection: "row",
                      alignItems: "center",
                      justifyContent: "space-between",
                      marginBottom: 6,
                      borderBottom: "1px solid #E2E8F0",
                      paddingBottom: 5,
                    }}
                  >
                    <View
                      style={{ flexDirection: "row", alignItems: "center" }}
                    >
                      <View style={{ width: 14, height: 14 }}>
                        <Icons.Car width={14} height={14} color="#2d2d44" />
                      </View>
                      <Text
                        style={{
                          fontSize: 11,
                          fontWeight: "bold",
                          color: "#1E293B",
                          marginLeft: 5,
                        }}
                      >
                        Your Transport
                      </Text>
                    </View>
                  </View>

                  {packageSummary.transfer?.details?.length > 0 ? (
  packageSummary?.transfer?.details?.map((cab, index) => {
    const cabImage = cabImageCache[index] || null;
    
    return (
      <View
        key={cab?._id || index}
        style={[
          accommodationStyles.card,
          { marginTop: index === 0 ? 10 : 10, marginBottom: 0 }
        ]}
      >
        {/* Cab Details - Left Column */}
        <View style={accommodationStyles.leftColumn}>
          {/* Cab Name */}
          <Text style={accommodationStyles.hotelName}>
            {cab?.cabName || "Standard Vehicle"}
          </Text>

          {/* Cab Type */}
          <Text style={accommodationStyles.subText}>
            {cab?.cabType || "Sedan"}
          </Text>

          {/* Cab Info Row */}
          <View style={accommodationStyles.infoRow}>
            {cab?.vehicleCategory && (
              <View style={accommodationStyles.infoColumn}>
                <Text style={accommodationStyles.infoHeading}>
                  CATEGORY
                </Text>
                <Text style={accommodationStyles.infoValue}>
                  {cab.vehicleCategory}
                </Text>
              </View>
            )}

            <View style={accommodationStyles.infoColumn}>
              <Text style={accommodationStyles.infoHeading}>
                SEATING
              </Text>
              <Text style={accommodationStyles.infoValue}>
                {cab?.cabSeatingCapacity || "4"} Seater
              </Text>
            </View>
          </View>
        </View>

        {/* Cab Image - Right Side */}
        {cabImage ? (
          <View style={accommodationStyles.imageWrapper}>
            <Image
              source={{ uri: cabImage }}
              style={{
                width: "100%",
                height: "100%",
                objectFit: "cover",
              }}
            />
          </View>
        ) : (
          <View style={accommodationStyles.placeholder}>
            <Text style={accommodationStyles.placeholderText}>
              Image unavailable
            </Text>
          </View>
        )}
      </View>
    );
  })
) : (
  <View
    style={{
      backgroundColor: "#F8FAFC",
      borderRadius: 6,
      padding: 5,
    }}
  >
    <Text
      style={{
        fontSize: 10,
        color: "#1E293B",
        fontWeight: "600",
        marginBottom: 1,
      }}
    >
      Standard Vehicle
    </Text>
    <Text
      style={{
        fontSize: 9,
        color: "#1E293B",
        marginBottom: 2,
      }}
    >
      Sedan
    </Text>
    <View style={{ flexDirection: "row", gap: 5, marginTop: 2 }}>
      <View
        style={{
          backgroundColor: "#EFF6FF",
          paddingHorizontal: 4,
          paddingVertical: 1,
          borderRadius: 3,
          flexDirection: "row",
          alignItems: "center",
        }}
      >
        <Text
          style={{
            fontSize: 8,
            color: "#2d2d44",
            fontWeight: "500",
          }}
        >
          {" "}
        </Text>
      </View>
      <View
        style={{
          backgroundColor: "#EFF6FF",
          paddingHorizontal: 4,
          paddingVertical: 1,
          borderRadius: 3,
          flexDirection: "row",
          alignItems: "center",
        }}
      >
        <Text
          style={{
            fontSize: 8,
            color: "#2d2d44",
            fontWeight: "500",
          }}
        >
          4 Seater
        </Text>
      </View>
    </View>
  </View>
)}

                </View>
              </View>
            </View>

            {/* Journey Stats */}
            <View
              style={{
                marginTop: 12,
                flexDirection: "row",
                justifyContent: "space-around",
                paddingTop: 12,
                borderTopWidth: 1,
                borderTopColor: "#E2E8F0",
              }}
            >
              <View
                style={{
                  alignItems: "center",
                }}
              >
                <Text
                  style={{
                    fontSize: 9,
                    color: "#64748B",
                  }}
                >
                  Total Cities
                </Text>
                <Text
                  style={{
                    fontSize: 11,
                    fontWeight: "bold",
                    color: "#1E293B",
                  }}
                >
                  {
                    new Set(
                      packageSummary.package?.itineraryDays?.map(
                        (day) => day.selectedItinerary?.cityName
                      )
                    ).size
                  }
                </Text>
              </View>
              <View
                style={{
                  alignItems: "center",
                }}
              >
                <Text
                  style={{
                    fontSize: 9,
                    color: "#64748B",
                  }}
                >
                  Total Days
                </Text>
                <Text
                  style={{
                    fontSize: 11,
                    fontWeight: "bold",
                    color: "#1E293B",
                  }}
                >
                  {packageSummary.package?.itineraryDays?.length}
                </Text>
              </View>
              <View
                style={{
                  alignItems: "center",
                }}
              >
                <Text
                  style={{
                    fontSize: 9,
                    color: "#64748B",
                  }}
                >
                  Total Distance
                </Text>
                <Text
                  style={{
                    fontSize: 11,
                    fontWeight: "bold",
                    color: "#1E293B",
                  }}
                >
                  {packageSummary.package?.itineraryDays?.reduce(
                    (acc, day) => acc + (day.selectedItinerary.distance || 0),
                    0
                  )}{" "}
                  km
                </Text>
              </View>
            </View>
          </View>

          {/* Main Content Section */}
          <View style={{
            flex: 1,
            marginBottom: 16,
          }}>
            {/* Modern Journey Itinerary Section */}
            <View
              style={{
                marginTop: 12,
                marginBottom: 16,
                backgroundColor: "#FFFFFF",
                borderRadius: 12,
                borderWidth: 1,
                borderColor: "#E2E8F0",
                overflow: "hidden",
              }}
            >
              {/* Modern Gradient Header */}
              <View
                style={{
                 
                  padding: 16,
                  position: "relative",
                  overflow: "hidden",
                }}
              >
                {/* Decorative Elements */}
                <View
                  style={{
                    position: "absolute",
                    top: -20,
                    right: -20,
                    width: 80,
                    height: 80,
                    backgroundColor: "rgba(255, 255, 255, 0.1)",
                    borderRadius: 40,
                  }}
                />
                <View
                  style={{
                    position: "absolute",
                    bottom: -15,
                    left: -15,
                    width: 60,
                    height: 60,
                    backgroundColor: "rgba(255, 255, 255, 0.05)",
                    borderRadius: 30,
                  }}
                />

                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    justifyContent: "space-between",
                    position: "relative",
                    zIndex: 2,
                  }}
                >
                  <View
                    style={{
                      flexDirection: "row",
                      alignItems: "center",
                      gap: 12,
                    }}
                  >
                    <View
                      style={{
                        backgroundColor: "rgba(255, 255, 255, 0.2)",
                        padding: 10,
                        borderRadius: 12,
                        backdropFilter: "blur(10px)",
                      }}
                    >
                      <View style={{ width: 28, height: 28 }}>
                        <Icons.Map width={28} height={28} color="#1E293B" />
                      </View>
                    </View>
                    <View>
                      <Text
                        style={{
                          fontSize: 26,
                          fontWeight: "bold",
                          color: "#1E293B",
                          marginBottom: 4,
                        }}
                      >
                        Your Journey Itinerary
                      </Text>
                      <View
                        style={{
                          flexDirection: "row",
                          alignItems: "center",
                          gap: 8,
                        }}
                      >
                        <View
                          style={{
                            backgroundColor: "rgba(255, 255, 255, 0.2)",
                            paddingHorizontal: 8,
                            paddingVertical: 4,
                            borderRadius: 12,
                          }}
                        >
                          <Text
                            style={{
                              fontSize: 12,
                              color: "#1E293B",
                              fontWeight: "600",
                            }}
                          >
                            {packageSummary?.package?.itineraryDays?.length}{" "}
                            Days
                          </Text>
                        </View>
                        <Text
                          style={{
                            fontSize: 14,
                            color: "#1E293B",
                          }}
                        >
                          of Adventure & Discovery
                        </Text>
                      </View>
                    </View>
                  </View>

                  {/* Journey Stats */}
                  <View
                    style={{
                      backgroundColor: "rgba(255, 255, 255, 0.15)",
                      padding: 12,
                      borderRadius: 12,
                      backdropFilter: "blur(10px)",
                      borderWidth: 1,
                      borderColor: "rgba(255, 255, 255, 0.2)",
                    }}
                  >
                    <Text
                      style={{
                        fontSize: 10,
                        color: "#1E293B",
                        marginBottom: 4,
                      }}
                    >
                      JOURNEY HIGHLIGHTS
                    </Text>
                    <View style={{ flexDirection: "row", gap: 12 }}>
                      <View style={{ alignItems: "center" }}>
                        <Text
                          style={{
                            fontSize: 16,
                            fontWeight: "bold",
                            color: "#1E293B",
                          }}
                        >
                          {
                            new Set(
                              packageSummary?.package?.itineraryDays?.map(
                                (day) => day.selectedItinerary?.cityName
                              )
                            ).size
                          }
                        </Text>
                        <Text
                          style={{
                            fontSize: 8,
                            color: "#1E293B",
                          }}
                        >
                          Cities
                        </Text>
                      </View>
                      <View style={{ alignItems: "center" }}>
                        <Text
                          style={{
                            fontSize: 16,
                            fontWeight: "bold",
                            color: "#1E293B",
                          }}
                        >
                          {packageSummary.hotels?.length || 0}
                        </Text>
                        <Text
                          style={{
                            fontSize: 8,
                            color: "#1E293B",
                          }}
                        >
                          Hotels
                        </Text>
                      </View>
                      <View style={{ alignItems: "center" }}>
                        <Text
                          style={{
                            fontSize: 16,
                            fontWeight: "bold",
                            color: "#1E293B",
                          }}
                        >
                          {packageSummary?.package?.itineraryDays?.reduce(
                            (acc, day) =>
                              acc + (day.selectedItinerary.distance || 0),
                            0
                          )}
                        </Text>
                        <Text
                          style={{
                            fontSize: 8,
                            color: "#1E293B",
                          }}
                        >
                          Km
                        </Text>
                      </View>
                    </View>
                  </View>
                </View>
              </View>

              {/* Compact City Route Overview */}
              <View
                style={{
                  backgroundColor: "#F8FAFC",
                  padding: 16,
                  borderBottomWidth: 1,
                  borderBottomColor: "#E2E8F0",
                }}
              >
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    marginBottom: 12,
                  }}
                >
                  <View style={{ width: 16, height: 16, marginRight: 8 }}>
                    <Icons.Location width={16} height={16} color="#2d2d44" />
                  </View>
                  <Text
                    style={{
                      fontSize: 14,
                      fontWeight: "600",
                      color: "#1E293B",
                    }}
                  >
                    Route Overview
                  </Text>
                </View>

                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    flexWrap: "wrap",
                    gap: 8,
                  }}
                >
                  {Array.from(
                    new Set(
                      packageSummary?.package?.itineraryDays?.map(
                        (day) => day.selectedItinerary?.cityName
                      )
                    )
                  ).map((cityName, index, cities) => (
                    <View
                      key={index}
                      style={{ flexDirection: "row", alignItems: "center" }}
                    >
                      <View
                        style={{
                          backgroundColor: "#EFF6FF",
                          paddingVertical: 6,
                          paddingHorizontal: 12,
                          borderRadius: 20,
                          borderWidth: 1,
                          borderColor: "#BFDBFE",
                          flexDirection: "row",
                          alignItems: "center",
                          gap: 6,
                        }}
                      >
                        <View
                          style={{
                            width: 8,
                            height: 8,
                            backgroundColor: "#2d2d44",
                            borderRadius: 4,
                          }}
                        />
                        <Text
                          style={{
                            fontSize: 12,
                            color: "#2d2d44",
                            fontWeight: "500",
                          }}
                        >
                          {cityName}
                        </Text>
                      </View>
                      {index < cities.length - 1 && (
                        <View
                          style={{
                            width: 16,
                            height: 2,
                            backgroundColor: "#CBD5E1",
                            marginHorizontal: 4,
                          }}
                        />
                      )}
                    </View>
                  ))}
                </View>
              </View>

              {/* Compact Day-by-Day Timeline */}
              <View style={{ padding: 12, gap: 12 }}>
                {packageSummary?.package?.itineraryDays?.map((day, index) => {
                  const dayData = day.selectedItinerary;
                  const dayHotel = getHotelForDay(day);
                  const previousDayHotel =
                    index > 0 ? getHotelForDay(itineraryDays[index - 1]) : null;
                  const isStartOfHotelStay =
                    !!dayHotel &&
                    dayHotel.propertyName !== previousDayHotel?.propertyName;
                  const consecutiveStayIndices = isStartOfHotelStay
                    ? getConsecutiveHotelIndices(index, dayHotel.propertyName)
                    : [];
                  const stayNightBadges = consecutiveStayIndices.map((dayIndex) =>
                    formatOrdinal(dayIndex + 1)
                  );
                  const hotelImageSource = isStartOfHotelStay
                    ? getHotelImageForDay(day)
                    : null;
                  const stayCity =
                    dayHotel?.cityName ||
                    dayHotel?.hotelCity ||
                    dayData?.cityName ||
                    "";
                  const similarOptions =
                    dayHotel?.similarHotels ||
                    dayHotel?.alternateHotels ||
                    dayHotel?.alternativeHotels;

                  // Calculate date
                  const startDate = selectedLead?.travelDate
                    ? new Date(selectedLead.travelDate)
                    : new Date();
                  const currentDate = new Date(startDate);
                  currentDate.setDate(startDate.getDate() + index);
                  const formattedDate = currentDate.toLocaleDateString(
                    "en-US",
                    {
                      weekday: "short",
                      day: "2-digit",
                      month: "short",
                    }
                  );

                  return (
                    <View 
                      key={index} 
                      wrap={false}
                      style={{ 
                        position: "relative",
                        marginBottom: 12,
                        minHeight: 200,
                      }}
                    >
                      {/* Timeline Connector */}
                      {index !==
                        packageSummary.package.itineraryDays.length - 1 && (
                        <View
                          style={{
                            position: "absolute",
                            left: 20,
                            top: 40,
                            bottom: -16,
                            width: 2,
                            backgroundColor: "#E2E8F0",
                            zIndex: 1,
                          }}
                        />
                      )}

                      {/* Day Card */}
                      <View
                        wrap={false}
                        style={{
                          backgroundColor: "#FFFFFF",
                          borderRadius: 12,
                          borderWidth: 1,
                          borderColor: "#E2E8F0",
                          overflow: "hidden",
                          position: "relative",
                          flexShrink: 0,
                          minHeight: 200,
                        }}
                      >
                        {/* Day Header */}
                        <View
                          style={{
                            backgroundColor: "#F8FAFC",
                            padding: 12,
                            borderBottomWidth: 1,
                            borderBottomColor: "#E2E8F0",
                            flexDirection: "row",
                            alignItems: "center",
                            gap: 12,
                          }}
                        >
                          {/* Day Badge */}
                          <View
                            style={{
                              width: 40,
                              height: 40,
                              backgroundColor: "#2d2d44",
                              borderRadius: 20,
                              alignItems: "center",
                              justifyContent: "center",
                              position: "relative",
                              zIndex: 2,
                              marginRight: 12,
                            }}
                          >
                            <Text
                              style={{
                                fontSize: 14,
                                fontWeight: "bold",
                                color: "#FFFFFF",
                              }}
                            >
                              {String(index + 1).padStart(2, "0")}
                            </Text>
                          </View>

                          {/* Date and Title in a vertical stack, but allow title to use flex space */}
                          <View style={{ flex: 1, minWidth: 0 }}>
                            <Text
                              style={{
                                fontSize: 10,
                                color: "#64748B",
                                marginBottom: 2,
                                whiteSpace: "nowrap",
                                overflow: "hidden",
                                textOverflow: "ellipsis",
                              }}
                            >
                              {formattedDate}
                            </Text>
                            <Text
                              style={{
                                fontSize: 16,
                                fontWeight: "bold",
                                color: "#1E293B",
                                marginBottom: 4,
                                lineHeight: 1.2,
                                flexShrink: 1,
                                minWidth: 0,
                              }}
                              wrap={false}
                            >
                              {dayData.itineraryTitle}
                            </Text>
                            <View
                              style={{
                                flexDirection: "row",
                                alignItems: "center",
                                gap: 6,
                              }}
                            >
                              <View style={{ width: 12, height: 12 }}>
                                <Icons.Location
                                  width={12}
                                  height={12}
                                  color="#64748B"
                                />
                              </View>
                              <Text style={{ fontSize: 12, color: "#64748B" }}>
                                {dayData?.cityName}
                              </Text>
                            </View>
                          </View>

                          {/* Quick Info Badges */}
                          <View
                            style={{
                              flexDirection: "row",
                              gap: 6,
                              marginLeft: 8,
                            }}
                          >
                            {dayData.meals && (
                              <View
                                style={{
                                  backgroundColor: "#ECFDF5",
                                  paddingHorizontal: 8,
                                  paddingVertical: 4,
                                  borderRadius: 12,
                                  borderWidth: 1,
                                  borderColor: "#A7F3D0",
                                }}
                              >
                                <Text
                                  style={{
                                    fontSize: 9,
                                    color: "#059669",
                                    fontWeight: "600",
                                  }}
                                >
                                  {dayData.meals}
                                </Text>
                              </View>
                            )}
                            {packageSummary?.activities &&
                              packageSummary.activities.filter(activity => activity.dayNumber === day.day).length > 0 && (
                                <View
                                  style={{
                                    backgroundColor: "#EFF6FF",
                                    paddingHorizontal: 8,
                                    paddingVertical: 4,
                                    borderRadius: 12,
                                    borderWidth: 1,
                                    borderColor: "#BFDBFE",
                                  }}
                                >
                                  <Text
                                    style={{
                                      fontSize: 9,
                                      color: "#2d2d44",
                                      fontWeight: "600",
                                    }}
                                  >
                                    {packageSummary.activities.filter(activity => activity.dayNumber === day.day).length} Activities
                                  </Text>
                                </View>
                              )}
                          </View>
                        </View>

                        {/* Day Content */}
                        <View style={{ padding: 12, gap: 8 }}>
                  

                          {/* Compact City Areas - Vertical Layout */}
                          {day.selectedItinerary?.cityArea &&
                            day.selectedItinerary.cityArea.length > 0 && (
                              <View style={{ gap: 8 }}>
                                <Text
                                  style={{
                                    fontSize: 11,
                                    fontWeight: "600",
                                    color: "#1E293B",
                                    marginBottom: 4,
                                  }}
                                >
                                  Places to Visit:
                                </Text>
                                <View
                                  style={{
                                    flexDirection: "column",
                                    gap: 6,
                                  }}
                                >
                                  {day.selectedItinerary.cityArea.map(
                                    (area, areaIndex) => {
                                      const areaText =
                                        typeof area === "string"
                                          ? area
                                          : area.placeName || area.city || "";
                                      return (
                                        <View
                                          key={areaIndex}
                                          style={{
                                            backgroundColor: "#F1F5F9",
                                            paddingHorizontal: 10,
                                            paddingVertical: 6,
                                            borderRadius: 8,
                                            flexDirection: "row",
                                            alignItems: "center",
                                            gap: 6,
                                            borderLeftWidth: 3,
                                            borderLeftColor: "#3B82F6",
                                          }}
                                        >
                                          <View style={{ width: 10, height: 10 }}>
                                            <Icons.Location
                                              width={10}
                                              height={10}
                                              color="#3B82F6"
                                            />
                                          </View>
                                          <Text
                                            style={{
                                              fontSize: 10,
                                              color: "#475569",
                                              fontWeight: "500",
                                            }}
                                          >
                                            {decodeHtmlEntities(areaText)}
                                          </Text>
                                        </View>
                                      );
                                    }
                                  )}
                                </View>
                              </View>
                            )}

                          {/* Compact Hotel Info - Show for every day */}
                          {dayHotel && (
                            <View style={accommodationStyles.card}>
                              <View style={accommodationStyles.leftColumn}>
                                <View style={accommodationStyles.badgeWrapper}>
                                  <View style={accommodationStyles.badge}>
                                    <Text style={accommodationStyles.badgeText}>
                                      {formatOrdinal(index + 1)} Night
                                    </Text>
                                  </View>
                                  <Text style={accommodationStyles.nightsText}>
                                    at{" "}
                                    <Text style={accommodationStyles.nightsCity}>
                                      {stayCity || "Destination"}
                                    </Text>
                                  </Text>
                                </View>

                                <Text style={accommodationStyles.subText}>
                                  Check-in on {formatDisplayDate(currentDate)}
                                </Text>

                                <Text style={accommodationStyles.hotelName}>
                                  {dayHotel.propertyName}
                                </Text>
                                {getStarDisplay(
                                  dayHotel.basicInfo?.hotelStarRating ||
                                    dayHotel.starRating
                                ) && (
                                  <Text style={accommodationStyles.starText}>
                                    {getStarDisplay(
                                      dayHotel.basicInfo?.hotelStarRating ||
                                        dayHotel.starRating
                                    )}
                                  </Text>
                                )}

                                <View style={accommodationStyles.infoRow}>
                                  <View style={accommodationStyles.infoColumn}>
                                    <Text style={accommodationStyles.infoHeading}>
                                      ROOMS
                                    </Text>
                                    <Text style={accommodationStyles.infoValue}>
                                      {dayHotel.roomName || "Standard Room"}
                                    </Text>
                                    
                                  </View>
                                  <View style={accommodationStyles.infoColumn}>
                                    <Text style={accommodationStyles.infoHeading}>
                                      MEAL PLAN
                                    </Text>
                                    <Text style={accommodationStyles.infoValue}>
                                      {dayHotel.mealPlan || "Breakfast"}
                                    </Text>
                                  </View>
                                </View>

                                {Array.isArray(similarOptions) &&
                                  similarOptions.length > 0 && (
                                    <View>
                                      <Text style={accommodationStyles.similarLabel}>
                                        Similar Options
                                      </Text>
                                      <Text style={accommodationStyles.similarValue}>
                                        {similarOptions
                                          .slice(0, 3)
                                          .map((hotelOption) =>
                                            typeof hotelOption === "string"
                                              ? hotelOption
                                              : hotelOption?.propertyName ||
                                                hotelOption?.name
                                          )
                                          .filter(Boolean)
                                          .join(", ")}
                                      </Text>
                                    </View>
                                  )}
                              </View>

                              {getHotelImageForDay(day) ? (
                                <View style={accommodationStyles.imageWrapper}>
                                  <Image
                                    source={{ uri: getHotelImageForDay(day) }}
                                    style={{
                                      width: "100%",
                                      height: "100%",
                                      objectFit: "cover",
                                    }}
                                  />
                                </View>
                              ) : (
                                <View style={accommodationStyles.placeholder}>
                                  <Text style={accommodationStyles.placeholderText}>
                                    Image unavailable
                                  </Text>
                                </View>
                              )}
                            </View>
                          )}

                          {/* Compact Activities */}
                          {packageSummary?.activities &&
                            packageSummary.activities.filter(activity => activity.dayNumber === day.day).length > 0 && (
                              <View style={{ gap: 6 }}>
                                <View
                                  style={{
                                    flexDirection: "row",
                                    alignItems: "center",
                                    gap: 6,
                                  }}
                                >
                                  <View style={{ width: 12, height: 12 }}>
                                    <Icons.Activity
                                      width={12}
                                      height={12}
                                      color="#2d2d44"
                                    />
                                  </View>
                                  <Text
                                    style={{
                                      fontSize: 11,
                                      fontWeight: "600",
                                      color: "#1E293B",
                                    }}
                                  >
                                    Activities
                                  </Text>
                                </View>
                                <View style={{ gap: 4 }}>
                                  {packageSummary.activities
                                    .filter(activity => activity.dayNumber === day.day)
                                    .slice(0, 3)
                                    .map((activity, actIndex) => (
                                      <View
                                        key={actIndex}
                                        style={{
                                          gap: 4,
                                          padding: 8,
                                          backgroundColor: "#F8FAFC",
                                          borderRadius: 6,
                                          borderWidth: 1,
                                          borderColor: "#E2E8F0",
                                        }}
                                      >
                                        <Text
                                          style={{
                                            fontSize: 11,
                                            fontWeight: "600",
                                            color: "#1E293B",
                                          }}
                                        >
                                          {activity.title}
                                        </Text>
                                        <Text
                                          style={{
                                            fontSize: 10,
                                            color: "#475569",
                                            lineHeight: 1.4,
                                          }}
                                        >
                                          {decodeHtmlEntities(activity.description)}
                                        </Text>
                                        {activity.thing_to_carry && (
                                          <View style={{ gap: 2 }}>
                                            <Text
                                              style={{
                                                fontSize: 9,
                                                color: "#64748B",
                                                fontWeight: "600",
                                              }}
                                            >
                                              Things to carry:
                                            </Text>
                                            {activity.thing_to_carry
                                              .replace(/<ul[^>]*>/gi, '')
                                              .replace(/<\/ul>/gi, '')
                                              .replace(/<li[^>]*>/gi, 'â€¢ ')
                                              .replace(/<\/li>/gi, '\n')
                                              .replace(/&nbsp;/gi, ' ')
                                              .split('\n')
                                              .filter(item => item.trim())
                                              .map((item, itemIndex) => (
                                                <Text
                                                  key={itemIndex}
                                                  style={{
                                                    fontSize: 9,
                                                    color: "#64748B",
                                                    marginLeft: 8,
                                                    lineHeight: 1.3,
                                                  }}
                                                >
                                                  {item.trim()}
                                                </Text>
                                              ))}
                                          </View>
                                        )}
                                      </View>
                                    ))}
                                  {packageSummary.activities.filter(activity => activity.dayNumber === day.day).length > 3 && (
                                    <Text
                                      style={{
                                        fontSize: 9,
                                        color: "#64748B",
                                        fontStyle: "italic",
                                      }}
                                    >
                                      +{packageSummary.activities.filter(activity => activity.dayNumber === day.day).length - 3} more
                                      activities
                                    </Text>
                                  )}
                                </View>
                              </View>
                            )}
                        </View>
                      </View>
                    </View>
                  );
                })}
              </View>
            </View>

            {/* Modern Inclusions Section */}
            <View
              style={{
                marginTop: 12,
                marginBottom: 12,
                backgroundColor: "#FFFFFF",
                borderRadius: 8,
                borderWidth: 1,
                borderColor: "#E2E8F0",
                overflow: "hidden",
              }}
            >
              {/* Header */}
              <View
                style={{
                  backgroundColor: "#F8FAFC",
                  padding: 10,
                  borderBottomWidth: 1,
                  borderBottomColor: "#E2E8F0",
                  flexDirection: "row",
                  alignItems: "center",
                  gap: 6,
                }}
              >
                <View style={{ width: 16, height: 16 }}>
                  <Icons.Check width={16} height={16} color="#16A34A" />
                </View>
                <Text
                  style={{
                    fontSize: 14,
                    fontWeight: "bold",
                    color: "#1E293B",
                  }}
                >
                  Package Inclusions
                </Text>
              </View>

              {/* Package Summary Stats */}
              <View
                style={{
                  flexDirection: "row",
                  padding: 12,
                  borderBottomWidth: 1,
                  borderBottomColor: "#E2E8F0",
                  backgroundColor: "#FAFAFA",
                  gap: 12,
                }}
              >
                {/* Total Hotels Card */}
                <View
                  style={{
                    flex: 1,
                    backgroundColor: "#EFF6FF",
                    borderRadius: 6,
                    padding: 10,
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 8,
                  }}
                >
                  <View style={{ width: 20, height: 20 }}>
                    <Icons.Hotel width={20} height={20} color="#2d2d44" />
                  </View>
                  <View>
                    <Text
                      style={{ fontSize: 8, color: "#64748B", marginBottom: 2 }}
                    >
                      TOTAL HOTELS
                    </Text>
                    <Text
                      style={{
                        fontSize: 14,
                        fontWeight: "bold",
                        color: "#1E293B",
                      }}
                    >
                      {packageSummary.hotels?.length || 0} Hotels
                    </Text>
                  </View>
                </View>

                {/* Total Days Card */}
                <View
                  style={{
                    flex: 1,
                    backgroundColor: "#F0FDF4",
                    borderRadius: 6,
                    padding: 10,
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 8,
                  }}
                >
                  <View style={{ width: 20, height: 20 }}>
                    <Icons.Calendar width={20} height={20} color="#16A34A" />
                  </View>
                  <View>
                    <Text
                      style={{ fontSize: 8, color: "#64748B", marginBottom: 2 }}
                    >
                      TOTAL DAYS
                    </Text>
                    <Text
                      style={{
                        fontSize: 14,
                        fontWeight: "bold",
                        color: "#1E293B",
                      }}
                    >
                      {packageSummary.package?.itineraryDays?.length || 0} Days
                    </Text>
                  </View>
                </View>
              </View>

              {/* Inclusions List */}
              <View style={{ padding: 16, gap: 14 }}>
                {/* Hotels */}
                <View
                  wrap={false}
                  style={{
                    flexDirection: "row",
                    alignItems: "flex-start",
                    gap: 12,
                    paddingBottom: 12,
                    borderBottomWidth: 1,
                    borderBottomColor: "#E2E8F0",
                    marginBottom: 4,
                    minHeight: 30,
                  }}
                >
                  <View style={{ 
                    width: 20, 
                    height: 20,
                    backgroundColor: "#DBEAFE",
                    borderRadius: 10,
                    alignItems: "center",
                    justifyContent: "center",
                    marginTop: 2,
                  }}>
                    <Icons.Hotel width={12} height={12} color="#3B82F6" />
                  </View>
                  <Text style={{ 
                    flex: 1, 
                    fontSize: 11, 
                    color: "#1E293B",
                    lineHeight: 1.6,
                    fontWeight: "500",
                  }}>
                    {packageSummary.hotels?.length || 0} Hotels accommodation
                    with {packageSummary.package?.itineraryDays?.length || 0}{" "}
                    days itinerary.
                  </Text>
                </View>

                {/* Main Inclusions - Enhanced with better styling */}
                {packageSummary?.package?.packageInclusions && (() => {
                  const parsedItems = parseHtmlContent(packageSummary.package.packageInclusions);
                  // Split items by newlines if they contain multiple lines
                  const allItems = [];
                  parsedItems.forEach((textSegments) => {
                    const textContent = Array.isArray(textSegments) 
                      ? textSegments.map(seg => seg.text).join("")
                      : textSegments;
                    // Split by newline or multiple spaces to create separate items
                    const lines = textContent.split(/\n+/).filter(line => line.trim().length > 0);
                    if (lines.length > 0) {
                      lines.forEach(line => {
                        allItems.push(line.trim());
                      });
                    } else if (textContent.trim().length > 0) {
                      allItems.push(textContent.trim());
                    }
                  });
                  
                  return (
                    <View style={{ gap: 14 }}>
                      {allItems.map((item, index) => {
                        const formattedText = formatInclusionExclusionText(item);
                        
                        return (
                          <View 
                            key={index}
                            wrap={false}
                            style={{
                              flexDirection: "row",
                              alignItems: "flex-start",
                              gap: 12,
                              paddingLeft: 4,
                              marginBottom: 4,
                              minHeight: 20,
                            }}
                          >
                            {/* Enhanced Green Bullet - Always visible for each item */}
                            <View style={{
                              width: 20,
                              height: 20,
                              alignItems: "center",
                              justifyContent: "flex-start",
                              paddingTop: 2,
                              flexShrink: 0,
                            }}>
                              <View style={{
                                width: 8,
                                height: 8,
                                backgroundColor: "#16A34A",
                                borderRadius: 4,
                                borderWidth: 2,
                                borderColor: "#86EFAC",
                              }} />
                            </View>
                            <Text style={{
                              flex: 1,
                              fontSize: 11,
                              color: "#1E293B",
                              lineHeight: 1.7,
                              textAlign: "left",
                              flexWrap: "wrap",
                            }}>
                              {formattedText}
                            </Text>
                          </View>
                        );
                      })}
                    </View>
                  );
                })()}
              </View>
            </View>

            {/* Package Exclusions Section */}
            <View style={{
              marginBottom: 12,
              backgroundColor: "#FFFFFF",
              borderRadius: 8,
              borderWidth: 1,
              borderColor: "#E2E8F0",
              overflow: "hidden",
            }}>
              {/* Header */}
              <View style={{
                backgroundColor: "#FEF2F2",
                padding: 14,
                flexDirection: "row",
                alignItems: "center",
                gap: 10,
                borderBottomWidth: 1,
                borderBottomColor: "#FEE2E2",
              }}>
                <View style={{
                  width: 32,
                  height: 32,
                  backgroundColor: "#DC2626",
                  borderRadius: 16,
                  alignItems: "center",
                  justifyContent: "center",
                }}>
                  <View style={{ width: 16, height: 16 }}>
                    <Icons.Close width={16} height={16} color="#FFFFFF" />
                  </View>
                </View>
                <Text style={{
                  fontSize: 14,
                  fontWeight: "bold",
                  color: "#991B1B",
                  letterSpacing: 0.5,
                }}>
                  Package Exclusions
                </Text>
              </View>

              {/* Main Exclusions - Enhanced with better styling */}
              {packageSummary?.package?.packageExclusions && (() => {
                const parsedItems = parseHtmlContent(packageSummary.package.packageExclusions);
                // Split items by newlines if they contain multiple lines
                const allItems = [];
                parsedItems.forEach((textSegments) => {
                  const textContent = Array.isArray(textSegments) 
                    ? textSegments.map(seg => seg.text).join("")
                    : textSegments;
                  // Split by newline or multiple spaces to create separate items
                  const lines = textContent.split(/\n+/).filter(line => line.trim().length > 0);
                  if (lines.length > 0) {
                    lines.forEach(line => {
                      allItems.push(line.trim());
                    });
                  } else if (textContent.trim().length > 0) {
                    allItems.push(textContent.trim());
                  }
                });
                
                return (
                  <View style={{ padding: 16, gap: 14 }}>
                    {allItems.map((item, index) => {
                      const formattedText = formatInclusionExclusionText(item);
                      
                      return (
                        <View 
                          key={index}
                          wrap={false}
                          style={{
                            flexDirection: "row",
                            alignItems: "flex-start",
                            gap: 12,
                            paddingLeft: 4,
                            marginBottom: 4,
                            minHeight: 20,
                          }}
                        >
                          {/* Enhanced Red Bullet - Always visible for each item */}
                          <View style={{
                            width: 20,
                            height: 20,
                            alignItems: "center",
                            justifyContent: "flex-start",
                            paddingTop: 2,
                            flexShrink: 0,
                          }}>
                            <View style={{
                              width: 8,
                              height: 8,
                              backgroundColor: "#EF4444",
                              borderRadius: 4,
                              borderWidth: 2,
                              borderColor: "#FCA5A5",
                            }} />
                          </View>
                          <Text style={{
                            flex: 1,
                            fontSize: 11,
                            color: "#1E293B",
                            lineHeight: 1.7,
                            textAlign: "left",
                            flexWrap: "wrap",
                          }}>
                            {formattedText}
                          </Text>
                        </View>
                      );
                    })}
                  </View>
                );
              })()}
              
              {/* Custom Exclusions - Enhanced with better styling */}
              {packageSummary?.package?.customExclusions?.map(
                (section, index) => (
                  <View 
                    key={index}
                    wrap={false}
                    style={{
                      padding: 16,
                      borderTopWidth: index === 0 && !packageSummary?.package?.packageExclusions ? 0 : 1,
                      borderTopColor: "#E2E8F0",
                      backgroundColor: index % 2 === 0 ? "#FFFFFF" : "#FAFAFA",
                      marginBottom: 8,
                      minHeight: 100,
                    }}
                  >
                    <View
                      wrap={false}
                      style={{
                        flexDirection: "row",
                        gap: 10,
                        marginBottom: 16,
                        backgroundColor: "#FEF2F2",
                        padding: 12,
                        borderRadius: 8,
                        alignItems: "center",
                        borderLeftWidth: 4,
                        borderLeftColor: "#DC2626",
                        flexShrink: 0,
                      }}
                    >
                      <View style={{
                        width: 24,
                        height: 24,
                        backgroundColor: "#DC2626",
                        borderRadius: 12,
                        alignItems: "center",
                        justifyContent: "center",
                      }}>
                        <View style={{ width: 12, height: 12 }}>
                          <Icons.Close width={12} height={12} color="#FFFFFF" />
                        </View>
                      </View>
                      <Text style={{
                        fontSize: 13,
                        fontWeight: "bold",
                        color: "#991B1B",
                        letterSpacing: 0.3,
                      }}>
                        {section.name}
                      </Text>
                    </View>
                    {/* Parse HTML content properly with list items and formatting */}
                    {(() => {
                      const parsedItems = parseHtmlContent(section.description);
                      // Split items by newlines if they contain multiple lines
                      const allItems = [];
                      parsedItems.forEach((textSegments) => {
                        const textContent = Array.isArray(textSegments) 
                          ? textSegments.map(seg => seg.text).join("")
                          : textSegments;
                        // Split by newline or multiple spaces to create separate items
                        const lines = textContent.split(/\n+/).filter(line => line.trim().length > 0);
                        if (lines.length > 0) {
                          lines.forEach(line => {
                            allItems.push(line.trim());
                          });
                        } else if (textContent.trim().length > 0) {
                          allItems.push(textContent.trim());
                        }
                      });
                      
                      return (
                        <View style={{ gap: 14 }}>
                          {allItems.map((item, idx) => {
                            const formattedText = formatInclusionExclusionText(item);
                            
                            return (
                              <View 
                                key={idx}
                                wrap={false}
                                style={{
                                  flexDirection: "row",
                                  alignItems: "flex-start",
                                  gap: 12,
                                  paddingLeft: 4,
                                  marginBottom: 4,
                                  minHeight: 20,
                                }}
                              >
                                {/* Enhanced Red Bullet - Always visible for each item */}
                                <View style={{
                                  width: 20,
                                  height: 20,
                                  alignItems: "center",
                                  justifyContent: "flex-start",
                                  paddingTop: 2,
                                  flexShrink: 0,
                                }}>
                                  <View style={{
                                    width: 8,
                                    height: 8,
                                    backgroundColor: "#EF4444",
                                    borderRadius: 4,
                                    borderWidth: 2,
                                    borderColor: "#FCA5A5",
                                  }} />
                                </View>
                                <Text style={{
                                  flex: 1,
                                  fontSize: 11,
                                  color: "#1E293B",
                                  lineHeight: 1.7,
                                  textAlign: "left",
                                  flexWrap: "wrap",
                                }}>
                                  {formattedText}
                                </Text>
                              </View>
                            );
                          })}
                        </View>
                      );
                    })()}
                  </View>
                )
              )}
            </View>
            {/* Account Details Section */}
            <AccountDetailsSection />

            {/* Package Cost Section */}
            <View style={{
              marginBottom: 12,
              padding: 12,
              backgroundColor: "#FFFFFF",
              borderRadius: 8,
              borderWidth: 1,
              borderColor: "#E2E8F0",
            }}>
              {/* Package Cost Card */}
              <View
                style={{
                  backgroundColor: "rgb(45 45 68)",
                  borderRadius: 10,
                  padding: 20,
                }}
              >
                <View style={pdfStyles.rowBetween}>
                  <View>
                    <Text
                      style={{
                        fontSize: 14,
                        fontWeight: "bold",
                        color: "#FFFFFF",
                      }}
                    >
                      Pay Now
                    </Text>
                    <Text
                      style={{ fontSize: 10, color: "#E2E8F0", marginTop: 4 }}
                    >
                      Pay 40% of the total amount to confirm the booking
                    </Text>
                  </View>
                  <Text
                    style={{
                      fontSize: 24,
                      fontWeight: "bold",
                      color: "#FFFFFF",
                      fontFamily: "Helvetica-Bold",
                    }}
                  >
                    Rs.
                    {showMargin
                      ? finalTotal.toFixed(0)
                      : packageSummary.totals.grandTotal}
                  </Text>
                </View>
              </View>

              {/* Payment Terms Card */}
              <View
                style={{
                  marginTop: 16,
                  padding: 12,
                  backgroundColor: "#FFFBEB",
                  borderRadius: 8,
                  borderWidth: 1,
                  borderColor: "#FEF3C7",
                }}
              >
                <View
                  style={{ flexDirection: "row", gap: 8, alignItems: "center" }}
                >
                  <View style={{ width: 14, height: 14 }}>
                    <Icons.Info width={14} height={14} color="rgb(45 45 68)" />
                  </View>
                  <Text
                    style={{
                      fontSize: 11,
                      color: "#92400E",
                      fontWeight: "500",
                    }}
                  >
                    Important Payment Information
                  </Text>
                </View>
                <Text
                  style={{
                    fontSize: 10,
                    color: "#92400E",
                    lineHeight: 1.5,
                    marginTop: 8,
                  }}
                >
                  â€¢ 40% advance payment required to confirm booking{"\n"}â€¢
                  Balance payment due 15 days before travel date{"\n"}â€¢ Prices
                  are subject to availability and may change
                </Text>
              </View>
            </View>

            {/* Enhanced Agent Info Box */}
            <View
              style={{
                marginBottom: 16,
                padding: 12,
                backgroundColor: "#F8FAFC",
                borderRadius: 8,
                borderWidth: 1,
                borderColor: "#E2E8F0",
                position: "relative",
                marginTop: 12,
              }}
            >
              {/* Decorative Element */}
              <View
                style={{
                  position: "absolute",
                  top: 0,
                  right: 0,
                  width: 60,
                  height: 60,
                  backgroundColor: "#EFF6FF",
                  borderBottomLeftRadius: 60,
                  opacity: 0.5,
                }}
              />

              {/* Agent Profile Section */}
              <View
                style={{
                  flexDirection: "row",
                  alignItems: "center",
                  marginBottom: 12,
                  gap: 12,
                }}
              >
                {/* Agent Avatar Circle */}
                <View
                  style={{
                    width: 40,
                    height: 40,
                    backgroundColor: "#BFDBFE",
                    borderRadius: 20,
                    alignItems: "center",
                    justifyContent: "center",
                  }}
                >
                  <Text
                    style={{
                      fontSize: 16,
                      fontWeight: "bold",
                      color: "#2d2d44",
                    }}
                  >
                    {(packageSummary.package?.agentName ||
                      "P")[0].toUpperCase()}
                  </Text>
                </View>
                {/* Agent Details */}
                <View style={{ flex: 1 }}>
                  <Text
                    style={{
                      fontSize: 8,
                      color: "#64748B",
                      marginBottom: 2,
                    }}
                  >
                    TRAVEL EXPERT
                  </Text>
                  <Text
                    style={{
                      fontSize: 14,
                      fontWeight: "bold",
                      color: "#1E293B",
                      marginBottom: 2,
                    }}
                  >
                    {packageSummary.package?.agentName || "Our Travel Agent"}
                  </Text>
                </View>
              </View>

              {/* Contact Information */}
              <View
                style={{
                  marginLeft: 52,
                  gap: 6,
                }}
              >
                {/* Phone */}
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 8,
                  }}
                >
                  <View style={{ width: 12, height: 12 }}>
                    <Icons.Phone width={12} height={12} color="#2d2d44" />
                  </View>
                  <Text
                    style={{
                      fontSize: 10,
                      color: "#64748B",
                    }}
                  >
                    {packageSummary.package?.agentPhone || "+91-8353056000"}
                  </Text>
                </View>

                {/* Email */}
                <View
                  style={{
                    flexDirection: "row",
                    alignItems: "center",
                    gap: 8,
                  }}
                >
                  <View style={{ width: 12, height: 12 }}>
                    <Icons.Email width={12} height={12} color="#2d2d44" />
                  </View>
                  <Text
                    style={{
                      fontSize: 10,
                      color: "#64748B",
                    }}
                  >
                    info@ptwholidays.com
                  </Text>
                </View>
              </View>

              {/* Quotation Timestamp */}
              <View
                style={{
                  marginTop: 12,
                  paddingTop: 12,
                  borderTopWidth: 1,
                  borderTopColor: "#E2E8F0",
                  flexDirection: "row",
                  alignItems: "center",
                  gap: 6,
                }}
              >
                <View style={{ width: 12, height: 12 }}>
                  <Icons.Calendar width={12} height={12} color="#64748B" />
                </View>
                <Text
                  style={{
                    fontSize: 9,
                    color: "#64748B",
                    fontStyle: "italic",
                  }}
                >
                  Quotation Created on {new Date().toLocaleDateString()}{" "}
                  {new Date().toLocaleTimeString()}
                </Text>
              </View>

              {/* Experience Badge */}
              <View
                style={{
                  position: "absolute",
                  top: 12,
                  right: 12,
                  backgroundColor: "#EFF6FF",
                  paddingVertical: 4,
                  paddingHorizontal: 8,
                  borderRadius: 12,
                  flexDirection: "row",
                  alignItems: "center",
                  gap: 4,
                }}
              >
                <View style={{ width: 10, height: 10 }}>
                  <Icons.Star width={10} height={10} color="#2d2d44" />
                </View>
                <Text
                  style={{
                    fontSize: 8,
                    color: "#2d2d44",
                    fontWeight: "bold",
                  }}
                >
                  5+ Years Experience
                </Text>
              </View>
            </View>

            {/* Environmental Note */}
            <View style={{
              marginBottom: 12,
              padding: 8,
              backgroundColor: "#F0FDF4",
              borderRadius: 6,
              borderWidth: 1,
              borderColor: "#BBF7D0",
            }}>
              <Text style={{
                fontSize: 9,
                color: "#166534",
                textAlign: "center",
                fontStyle: "italic",
              }}>
                Please think twice before printing this mail. Save paper, it's good for the environment.
              </Text>
            </View>

            {/* Date Change Policy Section */}
            <View 
              wrap={false}
              style={{
                marginBottom: 16,
                padding: 12,
                backgroundColor: "#FFFFFF",
                borderRadius: 8,
                borderWidth: 1,
                borderColor: "#E2E8F0",
                minHeight: 400,
              }}
            >
              <View wrap={false} style={{ marginBottom: 12 }}>
                <Text style={pdfStyles.policyTitle}>Date Change Policy</Text>
              </View>

              <View wrap={false} style={[pdfStyles.policyContainer, { minHeight: 350 }]}>
                <View wrap={false} style={pdfStyles.currentPolicyHeader}>
                  <Text style={pdfStyles.currentPolicyText}>
                    Your Current Policy
                  </Text>
                </View>

                {/* Policy Timeline Bar */}
                <View wrap={false} style={[pdfStyles.policyTimelineContainer, { minHeight: 100 }]}>
                  <View style={pdfStyles.policyTimeline}>
                    <View style={pdfStyles.timelineGradient} />
                    <View style={pdfStyles.cancelIcon}>
                      <Text style={pdfStyles.cancelX}>âœ•</Text>
                    </View>
                  </View>
                  <Text style={pdfStyles.afterBookingText}>AFTER BOOKING</Text>
                  <Text style={pdfStyles.nonRefundableText}>
                    Non Refundable
                  </Text>
                  <Text style={pdfStyles.noChangeText}>
                    Date Change is not allowed
                  </Text>
                </View>

                {/* Policy Points */}
                <View style={pdfStyles.policyPoints}>
                  <View wrap={false} style={[pdfStyles.policyPoint, { marginBottom: 10, minHeight: 30 }]}>
                    <View style={pdfStyles.bulletPoint} />
                    <Text style={pdfStyles.policyText}>
                      These are non-refundable amounts as per the current
                      components attached. In the case of component
                      change/modifications, the policy will change accordingly.
                    </Text>
                  </View>

                  <View wrap={false} style={[pdfStyles.policyPoint, { marginBottom: 10, minHeight: 30 }]}>
                    <View style={pdfStyles.bulletPoint} />
                    <Text style={pdfStyles.policyText}>
                      Date Change fees don't include any fare change in the
                      components on the new date. Fare difference as applicable
                      will be charged separately.
                    </Text>
                  </View>

                  <View wrap={false} style={[pdfStyles.policyPoint, { marginBottom: 10, minHeight: 30 }]}>
                    <View style={pdfStyles.bulletPoint} />
                    <Text style={pdfStyles.policyText}>
                      Date Change will depend on the availability of the
                      components on the new requested date.
                    </Text>
                  </View>

                  <View wrap={false} style={[pdfStyles.policyPoint, { marginBottom: 10, minHeight: 50 }]}>
                    <View style={pdfStyles.bulletPoint} />
                    <Text style={pdfStyles.policyText}>
                      Please note, TCS once collected cannot be refunded in case
                      of any cancellation / modification. You can claim the TCS
                      amount as adjustment against Income Tax payable at the
                      time of filing the return of income.
                    </Text>
                  </View>

                  <View wrap={false} style={[pdfStyles.policyPoint, { marginBottom: 0, minHeight: 30 }]}>
                    <View style={pdfStyles.bulletPoint} />
                    <Text style={pdfStyles.policyText}>
                      Cancellation charges shown is exclusive of all taxes and
                      taxes will be added as per applicable.
                    </Text>
                  </View>
                </View>
              </View>
            </View>
          </View>
        </View>
      </Page>

      {/* Second Page - Footer and Additional Info */}
      <Page
        size="A4"
        style={{
          ...pdfStyles.page,
          paddingTop: 20,
          paddingBottom: 20,
          paddingLeft: 20,
          paddingRight: 20,
          backgroundColor: "#ffffff",
        }}
        wrap={true}
      >
        {/* Footer Content */}
        <CompanyFooter />
      </Page>
    </Document>
  );
};

const AccountDetailsSection = () => (
  <View style={pdfStyles.accountDetailsSection}>
    <View wrap={false} style={{ marginBottom: 16 }}>
      <Text style={pdfStyles.accountDetailsHeader}>
        ACCOUNT DETAILS AND UPI ID
      </Text>
    </View>

    {/* Bank Grid Section */}
    <View style={pdfStyles.bankGrid}>
      {/* SBI Section */}
      <View wrap={false} style={[pdfStyles.bankCard, { minHeight: 180, marginBottom: 12 }]}>
        <Text style={pdfStyles.bankName}>STATE BANK OF INDIA A/C</Text>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C No:</Text>
          <Text style={pdfStyles.bankValue}>38207849663</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C Name:</Text>
          <Text style={pdfStyles.bankValue}>PT HOLIDAYS PVT. LTD.</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>Branch:</Text>
          <Text style={pdfStyles.bankValue}>PANTHAGHATI-SHIMLA</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>IFSC Code:</Text>
          <Text style={pdfStyles.bankValue}>SBIN0021763</Text>
        </View>
      </View>

      {/* HDFC Section */}
      <View wrap={false} style={[pdfStyles.bankCard, { minHeight: 180, marginBottom: 12 }]}>
        <Text style={pdfStyles.bankName}>HDFC BANK</Text>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C No:</Text>
          <Text style={pdfStyles.bankValue}>50200044011800</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C Name:</Text>
          <Text style={pdfStyles.bankValue}>PT HOLIDAYS PVT LTD</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>Branch:</Text>
          <Text style={pdfStyles.bankValue}>MAHELI-SHIMLA</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>IFSC Code:</Text>
          <Text style={pdfStyles.bankValue}>HDFC0003612</Text>
        </View>
      </View>

      {/* ICICI Section */}
      <View wrap={false} style={[pdfStyles.bankCard, { minHeight: 180, marginBottom: 12 }]}>
        <Text style={pdfStyles.bankName}>ICICI BANK</Text>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C No:</Text>
          <Text style={pdfStyles.bankValue}>36680550120</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C Name:</Text>
          <Text style={pdfStyles.bankValue}>PT HOLIDAYS PVT LTD</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>Branch:</Text>
          <Text style={pdfStyles.bankValue}>KASUMPATI-SHIMLA</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>IFSC Code:</Text>
          <Text style={pdfStyles.bankValue}>ICIC0003368</Text>
        </View>
      </View>

      {/* Bank of Baroda Section */}
      <View wrap={false} style={[pdfStyles.bankCard, { minHeight: 180, marginBottom: 12 }]}>
        <Text style={pdfStyles.bankName}>BANK OF BARODA</Text>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C No:</Text>
          <Text style={pdfStyles.bankValue}>54140200000060</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>A/C Name:</Text>
          <Text style={pdfStyles.bankValue}>PT HOLIDAYS PVT LTD</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>Branch:</Text>
          <Text style={pdfStyles.bankValue}>BCS-SHIMLA</Text>
        </View>
        <View style={pdfStyles.bankDetail}>
          <Text style={pdfStyles.bankLabel}>IFSC Code:</Text>
          <Text style={pdfStyles.bankValue}>BARB0NEWSIM</Text>
        </View>
      </View>
    </View>

    {/* UPI Section */}
    <View wrap={false} style={[pdfStyles.upiSection, { marginTop: 8 }]}>
      <View wrap={false} style={[pdfStyles.upiCard, { minHeight: 80, marginBottom: 8 }]}>
        <Text style={pdfStyles.upiTitle}>GOOGLE PAY @ PHONE PAY</Text>
        <Text style={pdfStyles.upiValue}>80917-53823</Text>
      </View>
      <View wrap={false} style={[pdfStyles.upiCard, { minHeight: 100 }]}>
        <Text style={pdfStyles.upiTitle}>UPI ID</Text>
        <Text style={pdfStyles.upiValue}>UpId: mdplutotours-2@okhdfcbank</Text>
        <Text style={pdfStyles.upiValue}>UpId: 981666196@sbi</Text>
      </View>
    </View>
  </View>
);

// Add this component for the footer
const CompanyFooter = () => (
  <View
    style={{
      flex: 1,
      padding: 20,
      backgroundColor: "rgb(45 45 68)",
      borderRadius: 16,
      marginTop: 20,
    }}
  >
    {/* Company Logo and Name Section */}
    <View
      style={{
        flexDirection: "row",
        alignItems: "center",
        justifyContent: "center",
        marginBottom: 15,
        borderBottom: "2px solid rgba(255, 255, 255, 0.1)",
        paddingBottom: 15,
      }}
    >
      <Image
        style={{
          width: 80,
          height: 100,
          marginRight: 12,
        }}
        source="https://res.cloudinary.com/dcp1ev1uk/image/upload/v1749122411/PTW_Holidays_Logo_1_mgi4uu.png"
      />

      <View>
        <Text
          style={{
            color: "#FFFFFF",
            fontSize: 20,
            fontWeight: "bold",
            fontFamily: "Helvetica-Bold",
          }}
        >
          PTW Holidays Pvt. Ltd.
        </Text>
        <Text
          style={{
            color: "#E2E8F0",
            fontSize: 10,
            marginTop: 4,
          }}
        >Your Trusted Travel Partner</Text>
      </View>
    </View>

    {/* Contact Information Grid */}
    <View
      style={{
        flexDirection: "row",
        justifyContent: "space-around",
        marginBottom: 15,
      }}
    >
      {/* Address */}
      <View
        style={{
          flexDirection: "row",
          alignItems: "center",
          flex: 1,
        }}
      >
        <View style={{ width: 16, height: 16, marginRight: 8 }}>
          <Icons.Location width={16} height={16} color="#FFFFFF" />
        </View>
        <Text
          style={{
            color: "#FFFFFF",
            fontSize: 9,
          }}
        >
          Sheryl Villa 2nd Floor, near Taste buds restaurant, Panthaghati,
          Shimla, Himachal Pradesh 171009
        </Text>
      </View>

      {/* Phone */}
      <View
        style={{
          flexDirection: "row",
          alignItems: "center",
          flex: 1,
          justifyContent: "center",
        }}
      >
        <View style={{ width: 16, height: 16, marginRight: 8 }}>
          <Icons.Phone width={16} height={16} color="#FFFFFF" />
        </View>
        <Text
          style={{
            color: "#FFFFFF",
            fontSize: 9,
          }}
        >
          +91-8353056000
        </Text>
      </View>

      {/* Website */}
      <View
        style={{
          flexDirection: "row",
          alignItems: "center",
          flex: 1,
          justifyContent: "flex-end",
        }}
      >
        <View style={{ width: 16, height: 16, marginRight: 8 }}>
          <Icons.Globe width={16} height={16} color="#FFFFFF" />
        </View>
        <Text
          style={{
            color: "#FFFFFF",
            fontSize: 9,
          }}
        >
          www.ptwholidays.com
        </Text>
      </View>
    </View>

    {/* Social Media Links */}
    <View
      style={{
        flexDirection: "row",
        justifyContent: "center",
        gap: 20,
        marginBottom: 15,
      }}
    >
      <View
        style={{
          backgroundColor: "rgba(255, 255, 255, 0.1)",
          padding: 8,
          borderRadius: 20,
        }}
      >
        <View style={{ width: 14, height: 14 }}>
          <Icons.Facebook width={14} height={14} color="#FFFFFF" />
        </View>
      </View>
      <View
        style={{
          backgroundColor: "rgba(255, 255, 255, 0.1)",
          padding: 8,
          borderRadius: 20,
        }}
      >
        <View style={{ width: 14, height: 14 }}>
          <Icons.Instagram width={14} height={14} color="#FFFFFF" />
        </View>
      </View>
      <View
        style={{
          backgroundColor: "rgba(255, 255, 255, 0.1)",
          padding: 8,
          borderRadius: 20,
        }}
      >
        <View style={{ width: 14, height: 14 }}>
          <Icons.Twitter width={14} height={14} color="#FFFFFF" />
        </View>
      </View>
    </View>

    {/* Copyright Text */}
    <Text
      style={{
        color: "#CBD5E1",
        fontSize: 7,
        textAlign: "center",
        marginTop: 8,
      }}
    >
      Â© {new Date().getFullYear()} PTW Holidays. All rights reserved.
    </Text>
  </View>
);

export default PlutoToursPDF;